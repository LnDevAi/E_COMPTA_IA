name: ğŸ§ª Test Cache GitHub Actions

on:
  workflow_dispatch:  # Permet de dÃ©clencher manuellement
  push:
    branches: [ main, develop ]

env:
  NODE_VERSION: '18'

jobs:
  test-cache:
    name: ğŸ§ª Test Cache NPM
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout du code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js avec cache
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: 'package-lock.json'

      - name: ğŸ“¦ Test installation dÃ©pendances
        run: |
          # VÃ©rification package-lock.json
          if [ -f "package-lock.json" ]; then
            echo "âœ… package-lock.json trouvÃ©"
            ls -la package-lock.json
          else
            echo "âš ï¸ package-lock.json manquant, gÃ©nÃ©ration..."
            npm install --package-lock-only
          fi
          
          # Test installation
          npm ci --legacy-peer-deps || npm install --legacy-peer-deps
          echo "âœ… Installation rÃ©ussie"

      - name: ğŸ§ª Test scripts basiques
        run: |
          npm run test:ci
          echo "âœ… Scripts npm opÃ©rationnels"

      - name: ğŸ“Š RÃ©sumÃ© du test
        run: |
          echo "ğŸ‰ Test cache GitHub Actions rÃ©ussi !"
          echo "âœ… Cache npm fonctionnel"
          echo "âœ… package-lock.json prÃ©sent"
          echo "âœ… DÃ©pendances installÃ©es"
          echo "âœ… Scripts npm opÃ©rationnels"