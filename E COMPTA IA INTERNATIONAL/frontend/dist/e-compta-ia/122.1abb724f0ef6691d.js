"use strict";(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[122],{5122:(P,_,c)=>{c.r(_),c.d(_,{EntriesComponent:()=>G});var d=c(177),p=c(4341),e=c(4438),g=c(1941),h=c(2374),f=c(1151),C=c(1626);let E=(()=>{class r{constructor(t){this.http=t}parseText(t){return this.http.post("/api/ai/parseText",t)}static{this.\u0275fac=function(i){return new(i||r)(e.KVO(C.Qq))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function j(r,l){if(1&r&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&r){const t=l.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function b(r,l){if(1&r){const t=e.RV6();e.j41(0,"li",36),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.selectTemplateForEdit(n))}),e.EFF(1),e.k0s()}if(2&r){const t=l.$implicit,i=e.XpG(2);e.AVh("active",t.id===i.editingTemplateId),e.R7$(),e.JRh(t.name)}}function k(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"input",2),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.compte,n)||(o.compte=n),e.Njj(n)}),e.k0s()(),e.j41(3,"td")(4,"input",2),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.libelle,n)||(o.libelle=n),e.Njj(n)}),e.k0s()(),e.j41(5,"td")(6,"input",37),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.debit,n)||(o.debit=n),e.Njj(n)}),e.k0s()(),e.j41(7,"td")(8,"input",37),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.credit,n)||(o.credit=n),e.Njj(n)}),e.k0s()(),e.j41(9,"td")(10,"button",38),e.bIt("click",function(){const n=e.eBV(t).index,o=e.XpG(2);return e.Njj(o.templateLines.splice(n,1))}),e.EFF(11,"\u2716"),e.k0s()()()}if(2&r){const t=l.$implicit;e.R7$(2),e.R50("ngModel",t.compte),e.R7$(2),e.R50("ngModel",t.libelle),e.R7$(2),e.R50("ngModel",t.debit),e.R7$(2),e.R50("ngModel",t.credit)}}function F(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",26)(1,"div",27)(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"div",28)(5,"div",29)(6,"h4"),e.EFF(7,"Liste"),e.k0s(),e.j41(8,"ul",30),e.DNE(9,b,2,3,"li",31),e.k0s(),e.j41(10,"div",32)(11,"input",33),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.templateName,n)||(o.templateName=n),e.Njj(n)}),e.k0s(),e.j41(12,"button",16),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.createOrUpdateTemplate())}),e.EFF(13),e.k0s(),e.j41(14,"button",34),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.deleteTemplate())}),e.EFF(15,"Supprimer"),e.k0s()()(),e.j41(16,"div",29)(17,"h4"),e.EFF(18,"Contenu du mod\xe8le"),e.k0s(),e.j41(19,"table",18)(20,"thead")(21,"tr")(22,"th"),e.EFF(23,"Compte"),e.k0s(),e.j41(24,"th"),e.EFF(25,"Libell\xe9"),e.k0s(),e.j41(26,"th"),e.EFF(27,"D\xe9bit"),e.k0s(),e.j41(28,"th"),e.EFF(29,"Cr\xe9dit"),e.k0s(),e.nrm(30,"th"),e.k0s()(),e.j41(31,"tbody"),e.DNE(32,k,12,4,"tr",19),e.k0s()(),e.j41(33,"button",16),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.templateLines.push({compte:"",libelle:"",debit:0,credit:0}))}),e.EFF(34,"Ajouter ligne"),e.k0s()()(),e.j41(35,"div",35)(36,"button",16),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.templateEditorOpen=!1)}),e.EFF(37,"Fermer"),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(3),e.SpI("Mod\xe8les \u2014 ",t.journalCode,""),e.R7$(6),e.Y8G("ngForOf",t.templatesForJournal),e.R7$(2),e.R50("ngModel",t.templateName),e.R7$(2),e.JRh(t.editingTemplateId?"Mettre \xe0 jour":"Cr\xe9er"),e.R7$(),e.Y8G("disabled",!t.editingTemplateId),e.R7$(18),e.Y8G("ngForOf",t.templateLines)}}function M(r,l){if(1&r&&(e.j41(0,"div",40),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.JRh(t.aiErr)}}function T(r,l){if(1&r){const t=e.RV6();e.j41(0,"div",26)(1,"div",27)(2,"h3"),e.EFF(3,"Assistant IA \u2014 Coller le texte OCR"),e.k0s(),e.j41(4,"textarea",39),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.aiText,n)||(o.aiText=n),e.Njj(n)}),e.k0s(),e.j41(5,"div",35)(6,"button",16),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.applyAi())}),e.EFF(7,"Proposer"),e.k0s(),e.j41(8,"button",16),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.aiModalOpen=!1)}),e.EFF(9,"Fermer"),e.k0s()(),e.DNE(10,M,2,1,"div",23),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.aiText),e.R7$(6),e.Y8G("ngIf",t.aiErr)}}function R(r,l){if(1&r){const t=e.RV6();e.j41(0,"li",48),e.bIt("mousedown",function(){const n=e.eBV(t).index,o=e.XpG(2).$implicit,s=e.XpG();return e.Njj(s.pickSuggest(o,n))}),e.j41(1,"span",49),e.EFF(2),e.k0s(),e.j41(3,"span",50),e.EFF(4),e.k0s()()}if(2&r){const t=l.$implicit,i=l.index,n=e.XpG(2).$implicit;e.AVh("active",i===n._active),e.R7$(2),e.JRh(t.code),e.R7$(2),e.JRh(t.intitule)}}function x(r,l){if(1&r&&(e.j41(0,"ul",46),e.DNE(1,R,5,4,"li",47),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngForOf",t._suggest)}}function I(r,l){if(1&r){const t=e.RV6();e.j41(0,"li",48),e.bIt("mousedown",function(){const n=e.eBV(t).index,o=e.XpG(2).$implicit,s=e.XpG();return e.Njj(s.pickTiers(o,n))}),e.j41(1,"span",49),e.EFF(2),e.k0s(),e.j41(3,"span",50),e.EFF(4),e.k0s()()}if(2&r){const t=l.$implicit,i=l.index,n=e.XpG(2).$implicit;e.AVh("active",i===n._tiersActive),e.R7$(2),e.JRh(t.code),e.R7$(2),e.JRh(t.name)}}function v(r,l){if(1&r&&(e.j41(0,"ul",46),e.DNE(1,I,5,4,"li",47),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.Y8G("ngForOf",t._tiersSuggest)}}function O(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td",41)(2,"input",42),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.compte,n)||(o.compte=n),e.Njj(n)}),e.bIt("input",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.onCompteInput(n))})("keydown",function(n){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.onCompteKey(n,o))}),e.k0s(),e.DNE(3,x,2,1,"ul",43),e.k0s(),e.j41(4,"td",41)(5,"input",44),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o._tiersQuery,n)||(o._tiersQuery=n),e.Njj(n)}),e.bIt("input",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.onTiersInput(n))})("keydown",function(n){const o=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.onTiersKey(n,o))}),e.k0s(),e.DNE(6,v,2,1,"ul",43),e.k0s(),e.j41(7,"td")(8,"input",2),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.libelle,n)||(o.libelle=n),e.Njj(n)}),e.k0s()(),e.j41(9,"td")(10,"input",45),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.debit,n)||(o.debit=n),e.Njj(n)}),e.bIt("input",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.recalc())}),e.k0s()(),e.j41(11,"td")(12,"input",45),e.mxI("ngModelChange",function(n){const o=e.eBV(t).$implicit;return e.DH7(o.credit,n)||(o.credit=n),e.Njj(n)}),e.bIt("input",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.recalc())}),e.k0s()(),e.j41(13,"td")(14,"button",38),e.bIt("click",function(){const n=e.eBV(t).index,o=e.XpG();return e.Njj(o.removeLine(n))}),e.EFF(15,"\u2716"),e.k0s()()()}if(2&r){const t=l.$implicit;e.R7$(2),e.R50("ngModel",t.compte),e.R7$(),e.Y8G("ngIf",t._suggest&&t._suggest.length),e.R7$(2),e.R50("ngModel",t._tiersQuery),e.R7$(),e.Y8G("ngIf",t._tiersSuggest&&t._tiersSuggest.length),e.R7$(2),e.R50("ngModel",t.libelle),e.R7$(2),e.R50("ngModel",t.debit),e.R7$(2),e.R50("ngModel",t.credit)}}function N(r,l){if(1&r&&(e.j41(0,"option",25),e.EFF(1),e.k0s()),2&r){const t=l.$implicit;e.Y8G("value",t.code),e.R7$(),e.Lme("",t.code," - ",t.intitule,"")}}function D(r,l){if(1&r&&(e.j41(0,"div",40),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.JRh(t.error)}}function $(r,l){if(1&r&&(e.j41(0,"div",51),e.EFF(1),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.JRh(t.ok)}}function y(r,l){if(1&r){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td")(16,"button",16),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.edit(n))}),e.EFF(17,"Modifier"),e.k0s(),e.j41(18,"button",38),e.bIt("click",function(){const n=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.del(n.id))}),e.EFF(19,"Supprimer"),e.k0s()()()}if(2&r){const t=l.$implicit;e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(t.date),e.R7$(2),e.JRh(t.journalCode),e.R7$(2),e.JRh(t.piece),e.R7$(2),e.JRh(t.reference),e.R7$(2),e.JRh(t.totalDebit),e.R7$(2),e.JRh(t.totalCredit)}}let G=(()=>{class r{constructor(t,i,n,o){this.js=t,this.coa=i,this.tiersSvc=n,this.ai=o,this.journalCode="OD",this.date=(new Date).toISOString().slice(0,10),this.piece="",this.reference="",this.selectedTemplateId="",this.templateEditorOpen=!1,this.templateName="",this.editingTemplateId=null,this.templateLines=[],this.lignes=[],this.tiers=[],this.totalDebit=0,this.totalCredit=0,this.error="",this.ok="",this.comptes=[],this.ecritures=[],this.templates=[],this.editingId=null,this.aiModalOpen=!1,this.aiText="",this.aiErr="",this.coa.getPlan().subscribe(s=>this.comptes=s.map(u=>({code:u.code,intitule:u.intitule}))),this.js.getEcritures().subscribe(s=>this.ecritures=s),this.js.getTemplates().subscribe(s=>{this.templates=s,this.refreshTemplatesForJournal()}),this.tiersSvc.getAll().subscribe(s=>this.tiers=s)}computeLibelleFromCode(t){if(!t)return"";const i=new Map(this.comptes.map(a=>[a.code,a.intitule])),n=i.get(t);if(!n)return"";let o=null;for(let a=t.length-1;a>=1;a--){const m=t.substring(0,a);if(i.has(m)){o=m;break}}if(!o)return n;const s=i.get(o)||"";if(!s)return n;const u=n.toLowerCase(),V=s.toLowerCase();return u.includes(V)?n:`${s} ${n}`.trim()}get templatesForJournal(){return this.templates.filter(t=>t.journalCode===this.journalCode)}refreshTemplatesForJournal(){this.selectedTemplateId&&!this.templatesForJournal.some(t=>t.id===this.selectedTemplateId)&&(this.selectedTemplateId="")}applySelectedTemplate(){const t=this.templates.find(i=>i.id===this.selectedTemplateId);t&&(this.journalCode=t.journalCode,this.lignes=t.lignes.map(i=>({...i})),this.recalc())}openTemplateEditor(){this.templateEditorOpen=!0,this.templateName="",this.editingTemplateId=null,this.templateLines=[{compte:"",libelle:"",debit:0,credit:0}]}selectTemplateForEdit(t){this.editingTemplateId=t.id,this.templateName=t.name,this.templateLines=t.lignes.map(i=>({...i}))}createOrUpdateTemplate(){const t=(this.templateName||"").trim();if(t)if(this.editingTemplateId)this.js.updateTemplate(this.editingTemplateId,t,this.templateLines),this.ok="Mod\xe8le mis \xe0 jour";else{const i=this.js.createTemplate(this.journalCode,t,this.templateLines);this.editingTemplateId=i.id,this.ok="Mod\xe8le cr\xe9\xe9"}else this.error="Nom de mod\xe8le requis"}deleteTemplate(){this.editingTemplateId&&confirm("Supprimer ce mod\xe8le ?")&&(this.js.deleteTemplate(this.editingTemplateId),this.editingTemplateId=null,this.templateName="",this.templateLines=[{compte:"",libelle:"",debit:0,credit:0}])}addLine(){this.lignes.push({compte:"",libelle:"",debit:0,credit:0,_suggest:[],_active:0,_tiersQuery:"",_tiersSuggest:[],_tiersActive:0})}removeLine(t){this.lignes.splice(t,1),this.recalc()}recalc(){this.totalDebit=this.lignes.reduce((t,i)=>t+(Number(i.debit)||0),0),this.totalCredit=this.lignes.reduce((t,i)=>t+(Number(i.credit)||0),0)}saveEntry(){this.error=this.ok="";try{if(this.editingId){const t={id:this.editingId,date:this.date,journalCode:this.journalCode,piece:this.piece,reference:this.reference,lignes:this.lignes.map(i=>({...i})),totalDebit:0,totalCredit:0};this.js.updateEcriture(t),this.ok="\xc9criture mise \xe0 jour"}else{const t=this.lignes.map(i=>({compte:i.compte,libelle:i.libelle,debit:Number(i.debit)||0,credit:Number(i.credit)||0,...i.tiersId?{tiersId:i.tiersId,tiersName:i.tiersName}:{}}));this.js.addEcriture({date:this.date,journalCode:this.journalCode,piece:this.piece,reference:this.reference,lignes:t}),this.ok="\xc9criture enregistr\xe9e"}this.lignes=[{compte:"",libelle:"",debit:0,credit:0}],this.recalc(),this.editingId=null}catch(t){this.error=t?.message||"Erreur"}}exportCsv(){const t=this.js.exportEcrituresCsv(),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download="ecritures.csv",n.click(),URL.revokeObjectURL(i)}onCompteInput(t){const i=(t.compte||"").toLowerCase().trim();if(!i)return t._suggest=[],void(t._active=0);const o=[];for(const s of this.comptes)if((s.code.toLowerCase().includes(i)||s.intitule.toLowerCase().includes(i))&&(o.push(s),o.length>=20))break;t._suggest=o,t._active=0}onCompteKey(t,i){i._suggest?.length&&("ArrowDown"===t.key?(t.preventDefault(),i._active=Math.min((i._active||0)+1,i._suggest.length-1)):"ArrowUp"===t.key?(t.preventDefault(),i._active=Math.max((i._active||0)-1,0)):"Enter"===t.key?(t.preventDefault(),this.pickSuggest(i,i._active||0)):"Escape"===t.key&&(i._suggest=[]))}pickSuggest(t,i){const n=t._suggest?.[i];n&&(t.compte=n.code,t.libelle||(t.libelle=this.computeLibelleFromCode(n.code)||n.intitule),t._suggest=[])}onTiersInput(t){const i=(t._tiersQuery||"").toLowerCase();if(!i)return t._tiersSuggest=[],void(t._tiersActive=0);t._tiersSuggest=this.tiers.filter(n=>n.code.toLowerCase().includes(i)||n.name.toLowerCase().includes(i)).slice(0,8),t._tiersActive=0}onTiersKey(t,i){i._tiersSuggest?.length&&("ArrowDown"===t.key?(i._tiersActive=Math.min(i._tiersSuggest.length-1,(i._tiersActive||0)+1),t.preventDefault()):"ArrowUp"===t.key?(i._tiersActive=Math.max(0,(i._tiersActive||0)-1),t.preventDefault()):"Enter"===t.key&&(this.pickTiers(i,i._tiersActive||0),t.preventDefault()))}pickTiers(t,i){const n=t._tiersSuggest[i];n&&(t.tiersId=n.id,t.tiersName=n.name,t._tiersQuery=`${n.code} - ${n.name}`,t._tiersSuggest=[],t._tiersActive=0)}onCompteChange(t){const i=this.computeLibelleFromCode(t.compte);i&&!t.libelle&&(t.libelle=i)}edit(t){this.editingId=t.id,this.journalCode=t.journalCode,this.date=t.date,this.piece=t.piece||"",this.reference=t.reference||"",this.lignes=t.lignes.map(i=>({...i})),this.recalc()}del(t){confirm("Supprimer cette \xe9criture ?")&&this.js.deleteEcriture(t)}openAiPaste(){this.aiErr="",this.aiText="",this.aiModalOpen=!0}applyAi(){this.aiErr="";const t=(this.aiText||"").trim();t?this.ai.parseText({text:t}).subscribe({next:i=>{const n=(i?.suggestions||[]).sort((o,s)=>(s.confidence||0)-(o.confidence||0))[0];n?(this.journalCode=n.journalCode||this.journalCode,this.piece=n.piece||this.piece,this.date=n.date||this.date,this.lignes=(n.lines||[]).map(o=>({compte:o.compte,libelle:o.libelle,debit:o.debit||0,credit:o.credit||0})),this.recalc(),this.aiModalOpen=!1):this.aiErr="Aucune suggestion."},error:i=>{this.aiErr="Erreur IA"}}):this.aiErr="Veuillez coller le texte OCR."}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(g.p),e.rXU(h.x),e.rXU(f.t),e.rXU(E))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-entries"]],standalone:!0,features:[e.aNF],decls:99,vars:26,consts:[[1,"module-container"],[1,"toolbar"],[1,"input",3,"ngModelChange","ngModel"],["value","ACH"],["value","VEN"],["value","BNK"],["value","OD"],["value","SAL"],["value","CSH"],["value","MNE"],["type","date",1,"input",3,"ngModelChange","ngModel"],["placeholder","Pi\xe8ce",1,"input",3,"ngModelChange","ngModel"],["placeholder","R\xe9f\xe9rence",1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"btn",3,"click"],["class","modal",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],["colspan","3"],["colspan","2"],["id","cpt"],["class","err",4,"ngIf"],["class","ok",4,"ngIf"],[3,"value"],[1,"modal"],[1,"modal-body"],[1,"modal-grid"],[1,"column"],[1,"tpl-list"],[3,"active","click",4,"ngFor","ngForOf"],[1,"row"],["placeholder","Nom du mod\xe8le",1,"input",3,"ngModelChange","ngModel"],[1,"btn","danger",3,"click","disabled"],[1,"modal-actions"],[3,"click"],["type","number","step","0.01",1,"input",3,"ngModelChange","ngModel"],[1,"btn","danger",3,"click"],[1,"input",2,"width","100%","height","180px",3,"ngModelChange","ngModel"],[1,"err"],[1,"autocomplete-cell"],[1,"input",3,"ngModelChange","input","keydown","ngModel"],["class","autocomplete",4,"ngIf"],["placeholder","Code/nom tiers",1,"input",3,"ngModelChange","input","keydown","ngModel"],["type","number","step","0.01",1,"input",3,"ngModelChange","input","ngModel"],[1,"autocomplete"],[3,"active","mousedown",4,"ngFor","ngForOf"],[3,"mousedown"],[1,"code"],[1,"label"],[1,"ok"]],template:function(i,n){1&i&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2,"\u{1f9fe} \xc9critures"),e.k0s(),e.j41(3,"div",1)(4,"label"),e.EFF(5,"Journal "),e.j41(6,"select",2),e.mxI("ngModelChange",function(s){return e.DH7(n.journalCode,s)||(n.journalCode=s),s}),e.j41(7,"option",3),e.EFF(8,"ACH - Achats"),e.k0s(),e.j41(9,"option",4),e.EFF(10,"VEN - Ventes"),e.k0s(),e.j41(11,"option",5),e.EFF(12,"BNK - Banque"),e.k0s(),e.j41(13,"option",6),e.EFF(14,"OD - Op\xe9rations diverses"),e.k0s(),e.j41(15,"option",7),e.EFF(16,"SAL - Salaires"),e.k0s(),e.j41(17,"option",8),e.EFF(18,"CSH - Caisses"),e.k0s(),e.j41(19,"option",9),e.EFF(20,"MNE - Monnaie \xe9lectronique"),e.k0s()()(),e.j41(21,"input",10),e.mxI("ngModelChange",function(s){return e.DH7(n.date,s)||(n.date=s),s}),e.k0s(),e.j41(22,"input",11),e.mxI("ngModelChange",function(s){return e.DH7(n.piece,s)||(n.piece=s),s}),e.k0s(),e.j41(23,"input",12),e.mxI("ngModelChange",function(s){return e.DH7(n.reference,s)||(n.reference=s),s}),e.k0s(),e.j41(24,"select",13),e.mxI("ngModelChange",function(s){return e.DH7(n.selectedTemplateId,s)||(n.selectedTemplateId=s),s}),e.bIt("change",function(){return n.applySelectedTemplate()}),e.j41(25,"option",14),e.EFF(26),e.k0s(),e.DNE(27,j,2,2,"option",15),e.k0s(),e.j41(28,"button",16),e.bIt("click",function(){return n.openTemplateEditor()}),e.EFF(29,"G\xe9rer les mod\xe8les"),e.k0s(),e.j41(30,"button",16),e.bIt("click",function(){return n.addLine()}),e.EFF(31,"Ajouter ligne"),e.k0s(),e.j41(32,"button",16),e.bIt("click",function(){return n.saveEntry()}),e.EFF(33,"Enregistrer"),e.k0s(),e.j41(34,"button",16),e.bIt("click",function(){return n.openAiPaste()}),e.EFF(35,"IA: coller texte OCR"),e.k0s()(),e.DNE(36,F,38,6,"div",17)(37,T,11,2,"div",17),e.j41(38,"table",18)(39,"thead")(40,"tr")(41,"th"),e.EFF(42,"Compte"),e.k0s(),e.j41(43,"th"),e.EFF(44,"Tiers"),e.k0s(),e.j41(45,"th"),e.EFF(46,"Libell\xe9"),e.k0s(),e.j41(47,"th"),e.EFF(48,"D\xe9bit"),e.k0s(),e.j41(49,"th"),e.EFF(50,"Cr\xe9dit"),e.k0s(),e.nrm(51,"th"),e.k0s()(),e.j41(52,"tbody"),e.DNE(53,O,16,7,"tr",19),e.k0s(),e.j41(54,"tfoot")(55,"tr")(56,"th",20),e.EFF(57,"Totaux"),e.k0s(),e.j41(58,"th"),e.EFF(59),e.nI1(60,"number"),e.k0s(),e.j41(61,"th"),e.EFF(62),e.nI1(63,"number"),e.k0s(),e.nrm(64,"th"),e.k0s(),e.j41(65,"tr")(66,"th",20),e.EFF(67,"Balance (doit \xeatre 0)"),e.k0s(),e.j41(68,"th",21),e.EFF(69),e.nI1(70,"number"),e.k0s(),e.nrm(71,"th"),e.k0s()()(),e.j41(72,"datalist",22),e.DNE(73,N,2,3,"option",15),e.k0s(),e.DNE(74,D,2,1,"div",23)(75,$,2,1,"div",24),e.j41(76,"h2"),e.EFF(77,"\xc9critures enregistr\xe9es"),e.k0s(),e.j41(78,"table",18)(79,"thead")(80,"tr")(81,"th"),e.EFF(82,"ID"),e.k0s(),e.j41(83,"th"),e.EFF(84,"Date"),e.k0s(),e.j41(85,"th"),e.EFF(86,"Journal"),e.k0s(),e.j41(87,"th"),e.EFF(88,"Pi\xe8ce"),e.k0s(),e.j41(89,"th"),e.EFF(90,"R\xe9f"),e.k0s(),e.j41(91,"th"),e.EFF(92,"D\xe9bit"),e.k0s(),e.j41(93,"th"),e.EFF(94,"Cr\xe9dit"),e.k0s(),e.j41(95,"th"),e.EFF(96,"Actions"),e.k0s()()(),e.j41(97,"tbody"),e.DNE(98,y,20,7,"tr",19),e.k0s()()()),2&i&&(e.R7$(6),e.R50("ngModel",n.journalCode),e.R7$(15),e.R50("ngModel",n.date),e.R7$(),e.R50("ngModel",n.piece),e.R7$(),e.R50("ngModel",n.reference),e.R7$(),e.R50("ngModel",n.selectedTemplateId),e.R7$(2),e.SpI("\u2014 Mod\xe8le (",n.templatesForJournal.length,") \u2014"),e.R7$(),e.Y8G("ngForOf",n.templatesForJournal),e.R7$(9),e.Y8G("ngIf",n.templateEditorOpen),e.R7$(),e.Y8G("ngIf",n.aiModalOpen),e.R7$(16),e.Y8G("ngForOf",n.lignes),e.R7$(6),e.JRh(e.i5U(60,17,n.totalDebit,"1.2-2")),e.R7$(3),e.JRh(e.i5U(63,20,n.totalCredit,"1.2-2")),e.R7$(7),e.JRh(e.i5U(70,23,n.totalDebit-n.totalCredit,"1.2-2")),e.R7$(4),e.Y8G("ngForOf",n.comptes),e.R7$(),e.Y8G("ngIf",n.error),e.R7$(),e.Y8G("ngIf",n.ok),e.R7$(23),e.Y8G("ngForOf",n.ecritures))},dependencies:[d.MD,d.Sq,d.bT,d.QX,p.YN,p.xH,p.y7,p.me,p.Q0,p.wz,p.BC,p.vS],styles:[".module-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 16px #00000014}.toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:8px;align-items:center}.input[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px}.btn[_ngcontent-%COMP%]{padding:8px 10px;border:none;border-radius:6px;background:#3182ce;color:#fff;cursor:pointer}.btn.danger[_ngcontent-%COMP%]{background:#e53e3e}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e2e8f0;padding:8px 10px;text-align:left}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f7fafc}.err[_ngcontent-%COMP%]{color:#e53e3e;margin-top:8px}.ok[_ngcontent-%COMP%]{color:#38a169;margin-top:8px}.autocomplete-cell[_ngcontent-%COMP%]{position:relative}.autocomplete[_ngcontent-%COMP%]{position:absolute;z-index:10;background:#fff;border:1px solid #e2e8f0;border-radius:6px;margin-top:2px;max-height:200px;overflow:auto;width:360px;box-shadow:0 6px 12px #00000014}.autocomplete[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:8px;padding:6px 8px;cursor:pointer}.autocomplete[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%], .autocomplete[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#f1f5f9}.autocomplete[_ngcontent-%COMP%]   .code[_ngcontent-%COMP%]{font-weight:600;min-width:80px}.autocomplete[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#334155}.modal[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center}.modal-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;width:min(100%,960px);max-height:90vh;overflow:auto}.modal-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:300px 1fr;gap:16px}.tpl-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;border:1px solid #e2e8f0;border-radius:6px;max-height:380px;overflow:auto}.tpl-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 12px;border-bottom:1px solid #edf2f7;cursor:pointer}.tpl-list[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%], .tpl-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background:#f1f5f9}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:12px}"]})}}return r})()}}]);