"use strict";(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[524],{8317:(h,u,r)=>{r.r(u),r.d(u,{LedgersComponent:()=>C});var b=r(467),m=r(177),g=r(4341),e=r(4438),F=r(1941);function E(d,f){if(1&d&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.nI1(13,"number"),e.k0s(),e.j41(14,"td"),e.EFF(15),e.nI1(16,"number"),e.k0s(),e.j41(17,"td"),e.EFF(18),e.nI1(19,"number"),e.k0s()()),2&d){const t=f.$implicit;e.R7$(2),e.JRh(t.date),e.R7$(2),e.JRh(t.journal),e.R7$(2),e.JRh(t.piece),e.R7$(2),e.JRh(t.reference),e.R7$(2),e.JRh(t.libelle),e.R7$(2),e.JRh(e.i5U(13,8,t.debit,"1.2-2")),e.R7$(3),e.JRh(e.i5U(16,11,t.credit,"1.2-2")),e.R7$(3),e.JRh(e.i5U(19,14,t.balance,"1.2-2"))}}function _(d,f){if(1&d&&(e.j41(0,"div",7)(1,"div",8),e.EFF(2,"Solde initial: "),e.j41(3,"b"),e.EFF(4),e.nI1(5,"number"),e.k0s(),e.EFF(6," \u2014 Solde courant: "),e.j41(7,"b"),e.EFF(8),e.nI1(9,"number"),e.k0s()(),e.j41(10,"table",9)(11,"thead")(12,"tr")(13,"th"),e.EFF(14,"Date"),e.k0s(),e.j41(15,"th"),e.EFF(16,"Journal"),e.k0s(),e.j41(17,"th"),e.EFF(18,"Pi\xe8ce"),e.k0s(),e.j41(19,"th"),e.EFF(20,"R\xe9f"),e.k0s(),e.j41(21,"th"),e.EFF(22,"Libell\xe9"),e.k0s(),e.j41(23,"th"),e.EFF(24,"D\xe9bit"),e.k0s(),e.j41(25,"th"),e.EFF(26,"Cr\xe9dit"),e.k0s(),e.j41(27,"th"),e.EFF(28,"Solde"),e.k0s()()(),e.j41(29,"tbody"),e.DNE(30,E,20,17,"tr",10),e.k0s()()()),2&d){const t=e.XpG();e.R7$(4),e.JRh(e.i5U(5,3,t.opening,"1.2-2")),e.R7$(4),e.JRh(e.i5U(9,6,t.current,"1.2-2")),e.R7$(22),e.Y8G("ngForOf",t.lines)}}let C=(()=>{class d{constructor(t){this.js=t,this.compte="",this.from=new Date((new Date).getFullYear(),0,1).toISOString().slice(0,10),this.to=(new Date).toISOString().slice(0,10),this.lines=[],this.opening=0,this.current=0}compute(){const t=this.js.ecritures$?.value||[],c=this.from,o=this.to,s=(this.compte||"").trim();let n=0;const i=[];for(const l of t)for(const p of l.lignes)if(!s||p.compte===s){if(l.date<c){n+=(Number(p.debit)||0)-(Number(p.credit)||0);continue}l.date>o||i.push({date:l.date,journal:l.journalCode,piece:l.piece,reference:l.reference,libelle:p.libelle,debit:Number(p.debit)||0,credit:Number(p.credit)||0,balance:0})}i.sort((l,p)=>l.date.localeCompare(p.date));let a=n;for(const l of i)a+=l.debit-l.credit,l.balance=a;this.opening=n,this.current=a,this.lines=i}exportCsv(){const c=this.lines.map(i=>[i.date,i.journal,i.piece||"",i.reference||"",this.csv(i.libelle),i.debit,i.credit,i.balance].join(";")),o=new Blob(["\ufeff"+["date;journal;piece;reference;libelle;debit;credit;solde",...c].join("\n")],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(o),n=document.createElement("a");n.href=s,n.download="grand-livre.csv",n.click(),URL.revokeObjectURL(s)}csv(t){return t?.includes(";")||t?.includes('"')?'"'+t.replace(/"/g,'""')+'"':t}exportPdf(){var t=this;return(0,b.A)(function*(){const{default:c}=yield r.e(107).then(r.bind(r,9107)),o=(yield Promise.all([r.e(107),r.e(941)]).then(r.t.bind(r,4941,23))).default,s=new c({orientation:"l",unit:"pt",format:"a4"});let i=32;s.setFontSize(14),s.text(`Grand Livre \u2014 Compte ${t.compte||"Tous"} ( ${t.from} \u2192 ${t.to} )`,32,i),i+=16,o(s,{startY:i,head:[["Date","Journal","Pi\xe8ce","R\xe9f","Libell\xe9","D\xe9bit","Cr\xe9dit","Solde"]],body:t.lines.map(a=>[a.date,a.journal,a.piece||"",a.reference||"",a.libelle,(a.debit||0).toFixed(2),(a.credit||0).toFixed(2),(a.balance||0).toFixed(2)]),styles:{fontSize:9},margin:{left:32,right:32}}),s.save("grand-livre.pdf")})()}static{this.\u0275fac=function(c){return new(c||d)(e.rXU(F.p))}}static{this.\u0275cmp=e.VBU({type:d,selectors:[["app-ledgers"]],standalone:!0,features:[e.aNF],decls:20,vars:6,consts:[[1,"module-container"],[1,"toolbar"],["placeholder","Ex: 601, 445, 512",1,"input",3,"ngModelChange","ngModel"],["type","date",1,"input",3,"ngModelChange","ngModel"],[1,"btn",3,"click"],[1,"btn",3,"click","disabled"],["class","panel",4,"ngIf"],[1,"panel"],[1,"row"],[1,"table"],[4,"ngFor","ngForOf"]],template:function(c,o){1&c&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2,"\u{1f4da} Grands Livres"),e.k0s(),e.j41(3,"div",1)(4,"label"),e.EFF(5,"Compte"),e.j41(6,"input",2),e.mxI("ngModelChange",function(n){return e.DH7(o.compte,n)||(o.compte=n),n}),e.k0s()(),e.j41(7,"label"),e.EFF(8,"Du "),e.j41(9,"input",3),e.mxI("ngModelChange",function(n){return e.DH7(o.from,n)||(o.from=n),n}),e.k0s()(),e.j41(10,"label"),e.EFF(11,"Au "),e.j41(12,"input",3),e.mxI("ngModelChange",function(n){return e.DH7(o.to,n)||(o.to=n),n}),e.k0s()(),e.j41(13,"button",4),e.bIt("click",function(){return o.compute()}),e.EFF(14,"Afficher"),e.k0s(),e.j41(15,"button",5),e.bIt("click",function(){return o.exportCsv()}),e.EFF(16,"Export CSV"),e.k0s(),e.j41(17,"button",5),e.bIt("click",function(){return o.exportPdf()}),e.EFF(18,"Export PDF"),e.k0s()(),e.DNE(19,_,31,9,"div",6),e.k0s()),2&c&&(e.R7$(6),e.R50("ngModel",o.compte),e.R7$(3),e.R50("ngModel",o.from),e.R7$(3),e.R50("ngModel",o.to),e.R7$(3),e.Y8G("disabled",!o.lines.length),e.R7$(2),e.Y8G("disabled",!o.lines.length),e.R7$(2),e.Y8G("ngIf",o.lines.length))},dependencies:[m.MD,m.Sq,m.bT,m.QX,g.YN,g.me,g.BC,g.vS],styles:[".module-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 16px #00000014}.toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;margin-bottom:8px}.input[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px}.btn[_ngcontent-%COMP%]{padding:8px 10px;border:none;border-radius:6px;background:#3182ce;color:#fff;cursor:pointer}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e2e8f0;padding:8px 10px;text-align:left}.panel[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:12px;margin-top:8px}"]})}}return d})()},5312:(h,u,r)=>{r.d(u,{c:()=>b});const b={production:!1,name:"development",amplify:{region:"us-west-2",apiUrl:"https://dev-api.e-compta-ia.com",cognitoDomain:"dev-auth.e-compta-ia.com"},apiUrl:"https://e-compta-ia-backend.dev",app:{name:"E-COMPTA-IA",version:"1.0.0",description:"Plateforme Comptable SYSCOHADA avec IA"}}}}]);