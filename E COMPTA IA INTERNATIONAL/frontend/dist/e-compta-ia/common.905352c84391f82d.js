(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[76],{4913:(f,d,o)=>{"use strict";o.d(d,{T:()=>p});var u=o(4412),h=o(4438);let p=(()=>{class l{constructor(){this.keyId="ecompta_enterprise_identity_v1",this.keySettings="ecompta_enterprise_settings_v1",this.keyUsers="ecompta_enterprise_users_v1",this.keyDirectors="ecompta_enterprise_directors_v1",this.keyTaxes="ecompta_enterprise_taxes_v1",this.identity$=new u.t(this.loadIdentity()),this.settings$=new u.t(this.loadSettings()),this.users$=new u.t(this.loadUsers()),this.directors$=new u.t(this.loadDirectors()),this.taxes$=new u.t(this.loadTaxes())}getIdentity(){return this.identity$.asObservable()}getSettings(){return this.settings$.asObservable()}getUsers(){return this.users$.asObservable()}getDirectors(){return this.directors$.asObservable()}getTaxes(){return this.taxes$.asObservable()}updateIdentity(s){const r={...this.identity$.value,...s};this.identity$.next(r),this.persist(this.keyId,r)}updateSettings(s){const r=this.settings$.value,e={fiscal:{...r.fiscal||{},...s.fiscal||{}},social:{...r.social||{},...s.social||{}},app:{...r.app||{},...s.app||{}}};this.settings$.next(e),this.persist(this.keySettings,e)}addUser(s){const r=`U-${Date.now()}`,e=[...this.users$.value,{...s,id:r}];this.users$.next(e),this.persist(this.keyUsers,e)}updateUser(s,r){const e=this.users$.value.map(t=>t.id===s?{...t,...r}:t);this.users$.next(e),this.persist(this.keyUsers,e)}removeUser(s){const r=this.users$.value.filter(e=>e.id!==s);this.users$.next(r),this.persist(this.keyUsers,r)}addDirector(s){const r=`D-${Date.now()}`,e=[...this.directors$.value,{...s,id:r}];this.directors$.next(e),this.persist(this.keyDirectors,e)}updateDirector(s,r){const e=this.directors$.value.map(t=>t.id===s?{...t,...r}:t);this.directors$.next(e),this.persist(this.keyDirectors,e)}removeDirector(s){const r=this.directors$.value.filter(e=>e.id!==s);this.directors$.next(r),this.persist(this.keyDirectors,r)}addTax(s){const r=`T-${Date.now()}`,e=[...this.taxes$.value,{...s,id:r}];this.taxes$.next(e),this.persist(this.keyTaxes,e)}updateTax(s,r){const e=this.taxes$.value.map(t=>t.id===s?{...t,...r}:t);this.taxes$.next(e),this.persist(this.keyTaxes,e)}removeTax(s){const r=this.taxes$.value.filter(e=>e.id!==s);this.taxes$.next(r),this.persist(this.keyTaxes,r)}replaceAllTaxes(s){const r=s.map((e,t)=>({...e,id:`T-${Date.now()}-${t}`}));this.taxes$.next(r),this.persist(this.keyTaxes,r)}roleTemplate(s){switch(s){case"ADMIN":return{canView:!0,canEditEntries:!0,canManageUsers:!0,canSubmitDeclarations:!0,canConfigure:!0,canImportExport:!0};case"COMPTABLE":return{canView:!0,canEditEntries:!0,canManageUsers:!1,canSubmitDeclarations:!0,canConfigure:!1,canImportExport:!0};case"VALIDEUR":return{canView:!0,canEditEntries:!1,canManageUsers:!1,canSubmitDeclarations:!0,canConfigure:!1,canImportExport:!1};default:return{canView:!0,canEditEntries:!1,canManageUsers:!1,canSubmitDeclarations:!1,canConfigure:!1,canImportExport:!1}}}loadIdentity(){try{const s=localStorage.getItem(this.keyId),r=s?JSON.parse(s):{},e=r.banks||(r.bankName||r.bankAccount?[{bankName:r.bankName||"",account:r.bankAccount||""}]:[]);return{name:"",legalForm:"",registrationNumber:"",taxId:"",activity:"",country:"",city:"",address:"",email:"",phone:"",...r,banks:e}}catch{return{name:"",legalForm:"",registrationNumber:"",taxId:"",activity:"",country:"",city:"",address:"",email:"",phone:""}}}loadSettings(){try{const s=localStorage.getItem(this.keySettings);return s?JSON.parse(s):{fiscal:{},social:{},app:{country:"",defaultJournal:"OD",defaultCurrency:"XOF",locale:"fr-FR",accountingSystem:"SYSCOHADA",chartOfAccounts:"SYSCOHADA"}}}catch{return{fiscal:{},social:{},app:{country:"",defaultJournal:"OD",defaultCurrency:"XOF",locale:"fr-FR",accountingSystem:"SYSCOHADA",chartOfAccounts:"SYSCOHADA"}}}}loadUsers(){try{const s=localStorage.getItem(this.keyUsers);return s?JSON.parse(s):[]}catch{return[]}}loadDirectors(){try{const s=localStorage.getItem(this.keyDirectors);return s?JSON.parse(s):[]}catch{return[]}}loadTaxes(){try{const s=localStorage.getItem(this.keyTaxes);return s?JSON.parse(s):[]}catch{return[]}}persist(s,r){try{localStorage.setItem(s,JSON.stringify(r))}catch{}}static{this.\u0275fac=function(r){return new(r||l)}}static{this.\u0275prov=h.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},1941:(f,d,o)=>{"use strict";o.d(d,{p:()=>s});var u=o(4412),h=o(8141),p=o(5312),l=o(4438),m=o(1626);let s=(()=>{class r{constructor(t){this.http=t,this.api=p.c.apiUrl,this.journaux$=new u.t([]),this.ecritures$=new u.t([]),this.templates$=new u.t(this.loadTemplates()),this.refreshJournaux(),this.refreshEcritures()}getJournaux(){return this.journaux$.asObservable()}getEcritures(){return this.ecritures$.asObservable()}getTemplates(){return this.templates$.asObservable()}refreshJournaux(){this.http.get(`${this.api}/api/journaux`).subscribe({next:t=>this.journaux$.next(t.items||[])})}createJournal(t){return this.http.post(`${this.api}/api/journaux`,t).pipe((0,h.M)(()=>this.refreshJournaux())).subscribe()}updateJournal(t,i){return this.http.put(`${this.api}/api/journaux/${encodeURIComponent(t)}`,i).pipe((0,h.M)(()=>this.refreshJournaux())).subscribe()}removeJournal(t){return this.http.delete(`${this.api}/api/journaux/${encodeURIComponent(t)}`).pipe((0,h.M)(()=>this.refreshJournaux())).subscribe()}refreshEcritures(){this.http.get(`${this.api}/api/ecritures`).subscribe({next:t=>this.ecritures$.next(t.items||[])})}addEcriture(t){return this.http.post(`${this.api}/api/ecritures`,t).pipe((0,h.M)(()=>this.refreshEcritures())).subscribe()}addEcrituresBatch(t){for(const i of t)this.http.post(`${this.api}/api/ecritures`,i).subscribe({next:()=>this.refreshEcritures()})}deleteEcriture(t){return this.http.delete(`${this.api}/api/ecritures/${encodeURIComponent(t)}`).pipe((0,h.M)(()=>this.refreshEcritures())).subscribe()}getEcriture(t){return this.ecritures$.value.find(i=>i.id===t)}updateEcriture(t){this.deleteEcriture(t.id);const{id:i,totalDebit:n,totalCredit:a,...c}=t;this.addEcriture(c)}createTemplate(t,i,n){const c={id:`${t}-${Date.now()}`,journalCode:t,name:i,lignes:n.map($=>({...$}))},x=[...this.templates$.value,c];return this.templates$.next(x),this.persistTemplates(x),c}updateTemplate(t,i,n){const a=this.templates$.value.map(c=>c.id===t?{...c,name:i,lignes:n.map(x=>({...x}))}:c);this.templates$.next(a),this.persistTemplates(a)}deleteTemplate(t){const i=this.templates$.value.filter(n=>n.id!==t);this.templates$.next(i),this.persistTemplates(i)}loadTemplates(){try{const t=localStorage.getItem("ecompta_templates_v1");return t?JSON.parse(t):[]}catch{return[]}}persistTemplates(t){try{localStorage.setItem("ecompta_templates_v1",JSON.stringify(t))}catch{}}exportJournauxCsv(){const i=this.journaux$.value.map(n=>[n.code,this.csv(n.libelle),n.type].join(";"));return new Blob(["\ufeff"+["code;libelle;type",...i].join("\n")],{type:"text/csv;charset=utf-8;"})}exportEcrituresCsv(t){const n=[];for(const a of this.ecritures$.value)if(!t||a.journalCode===t)for(const c of a.lignes)n.push([a.id,a.date,a.journalCode,a.piece||"",a.reference||"",c.compte,this.csv(c.libelle),c.debit,c.credit].join(";"));return new Blob(["\ufeff"+["id;date;journal;piece;reference;compte;libelle;debit;credit",...n].join("\n")],{type:"text/csv;charset=utf-8;"})}exportHtmlTableExcel(t){return new Blob([t],{type:"application/vnd.ms-excel"})}csv(t){return t?.includes(";")||t?.includes('"')?'"'+t.replace(/"/g,'""')+'"':t}static{this.\u0275fac=function(i){return new(i||r)(l.KVO(m.Qq))}}static{this.\u0275prov=l.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})()},1151:(f,d,o)=>{"use strict";o.d(d,{t:()=>m});var u=o(4412),h=o(5312),p=o(4438),l=o(1626);let m=(()=>{class s{constructor(e){this.http=e,this.tiers$=new u.t([]),this.api=h.c.apiUrl,this.refresh()}getAll(){return this.tiers$.asObservable()}getValue(){return this.tiers$.value}refresh(){this.http.get(`${this.api}/api/tiers`).subscribe({next:e=>this.tiers$.next(e.items||[])})}getNextCode(e){const t="CLIENT"===e?"CLT":"FOURNISSEUR"===e?"FRS":"AUT",i=this.tiers$.value.filter(a=>a.type===e&&a.code.startsWith(t+"-")).map(a=>parseInt(a.code.slice(4),10)).filter(a=>!isNaN(a)),n=i.length?Math.max(...i)+1:1;return`${t}-${String(n).padStart(4,"0")}`}isCodeTaken(e,t){return this.tiers$.value.some(i=>i.code.toUpperCase()===e.toUpperCase()&&i.id!==t)}create(e){return this.http.post(`${this.api}/api/tiers`,e).subscribe({next:()=>this.refresh()})}update(e,t){return this.http.put(`${this.api}/api/tiers/${encodeURIComponent(e)}`,t).subscribe({next:()=>this.refresh()})}remove(e){return this.http.delete(`${this.api}/api/tiers/${encodeURIComponent(e)}`).subscribe({next:()=>this.refresh()})}exportCsv(){const t=this.tiers$.value.map(i=>[i.id,i.code,this.csv(i.name),i.type,i.email||"",i.phone||"",this.csv(i.address||""),i.defaultAccount||""].join(";"));return new Blob(["\ufeff"+["id;code;name;type;email;phone;address;defaultAccount",...t].join("\n")],{type:"text/csv;charset=utf-8;"})}importCsv(e){const t=e.split(/\r?\n/).filter(i=>i.trim().length>0);if(!(t.length<=1))for(let i=1;i<t.length;i++){const n=this.parseCsvLine(t[i]),[a,c,x,$,v,g,y,E]=n,_=String($||"AUTRE").toUpperCase(),b={code:(c||"").trim(),name:x?.replace(/^"|"$/g,""),type:_,email:v,phone:g,address:y?.replace(/^"|"$/g,""),defaultAccount:E};this.create(b)}}csv(e){return e?.includes(";")||e?.includes('"')?'"'+e.replace(/"/g,'""')+'"':e}parseCsvLine(e){const t=[];let i="",n=!1;for(let a=0;a<e.length;a++){const c=e[a];'"'===c?(n=!n,i+=c):";"!==c||n?i+=c:(t.push(i),i="")}return t.push(i),t}static{this.\u0275fac=function(t){return new(t||s)(p.KVO(l.Qq))}}static{this.\u0275prov=p.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()},9293:f=>{function d(u,h,p,l,m,s,r){try{var e=u[s](r),t=e.value}catch(i){return void p(i)}e.done?h(t):Promise.resolve(t).then(l,m)}f.exports=function o(u){return function(){var h=this,p=arguments;return new Promise(function(l,m){var s=u.apply(h,p);function r(t){d(s,l,m,r,e,"next",t)}function e(t){d(s,l,m,r,e,"throw",t)}r(void 0)})}},f.exports.__esModule=!0,f.exports.default=f.exports}}]);