"use strict";(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[597],{2597:(Y,g,u)=>{u.r(g),u.d(g,{ChartOfAccountsComponent:()=>S});var _=u(177),d=u(4341),e=u(4438),b=u(2374);const f=i=>({$implicit:i});function k(i,c){if(1&i&&(e.j41(0,"option",31),e.EFF(1),e.k0s()),2&i){const t=c.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function F(i,c){if(1&i&&(e.j41(0,"span",32),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("",t.importErrors.length," erreurs")}}function j(i,c){if(1&i&&(e.j41(0,"div",32),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.JRh(t.addError)}}function O(i,c){if(1&i&&(e.j41(0,"div",33),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.JRh(t.addSuccess)}}function E(i,c){if(1&i){const t=e.RV6();e.j41(0,"span",42),e.bIt("click",function(){e.eBV(t);const n=e.XpG().$implicit,s=e.XpG(3);return e.Njj(s.toggleExpand(n))}),e.EFF(1),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.expanded?"\u25bc":"\u25b6")}}function I(i,c){}function v(i,c){if(1&i&&(e.j41(0,"div",43),e.DNE(1,I,0,0,"ng-template",34),e.k0s()),2&i){const t=e.XpG().$implicit;e.XpG(2);const o=e.sdS(4);e.R7$(),e.Y8G("ngTemplateOutlet",o)("ngTemplateOutletContext",e.eq3(2,f,t.children))}}function x(i,c){if(1&i){const t=e.RV6();e.j41(0,"li"),e.DNE(1,E,2,1,"span",36),e.j41(2,"span",37),e.EFF(3),e.k0s(),e.j41(4,"input",38),e.mxI("ngModelChange",function(n){const s=e.eBV(t).$implicit;return e.DH7(s.intitule,n)||(s.intitule=n),e.Njj(n)}),e.k0s(),e.j41(5,"button",39),e.bIt("click",function(){const n=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.saveNode(n))}),e.EFF(6,"\u{1f4be}"),e.k0s(),e.j41(7,"button",40),e.bIt("click",function(){const n=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.confirmDeleteNode(n))}),e.EFF(8,"\u{1f5d1}\ufe0f"),e.k0s(),e.DNE(9,v,2,4,"div",41),e.k0s()}if(2&i){const t=c.$implicit;e.R7$(),e.Y8G("ngIf",t.children.length),e.R7$(2),e.JRh(t.code),e.R7$(),e.R50("ngModel",t.intitule),e.Y8G("disabled",t.locked),e.R7$(),e.Y8G("disabled",t.locked),e.R7$(2),e.Y8G("disabled",t.locked),e.R7$(2),e.Y8G("ngIf",t.expanded&&t.children.length)}}function y(i,c){if(1&i&&(e.j41(0,"ul"),e.DNE(1,x,10,7,"li",35),e.k0s()),2&i){const t=c.$implicit;e.R7$(),e.Y8G("ngForOf",t)}}function R(i,c){}function T(i,c){if(1&i&&(e.j41(0,"div")(1,"h3"),e.EFF(2,"Arborescence"),e.k0s(),e.DNE(3,y,2,1,"ng-template",null,2,e.C5r)(5,R,0,0,"ng-template",34),e.k0s()),2&i){const t=e.sdS(4),o=e.XpG();e.R7$(5),e.Y8G("ngTemplateOutlet",t)("ngTemplateOutletContext",e.eq3(2,f,o.roots))}}function M(i,c){if(1&i&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s()()),2&i){const t=c.$implicit;e.R7$(2),e.JRh(t.code),e.R7$(2),e.JRh(t.intitule)}}function w(i,c){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"table",49)(2,"thead")(3,"tr")(4,"th",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.sortBy("code"))}),e.EFF(5),e.k0s(),e.j41(6,"th",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG(4);return e.Njj(n.sortBy("intitule"))}),e.EFF(7),e.k0s()()(),e.j41(8,"tbody"),e.DNE(9,M,5,2,"tr",35),e.k0s()()()}if(2&i){const t=e.XpG().$implicit,o=e.XpG(3);e.R7$(5),e.SpI("Code ","code"===o.sortKey?"asc"===o.sortDir?"\u25b2":"\u25bc":"",""),e.R7$(2),e.SpI("Intitul\xe9 ","intitule"===o.sortKey?"asc"===o.sortDir?"\u25b2":"\u25bc":"",""),e.R7$(2),e.Y8G("ngForOf",o.grouped[t])}}function A(i,c){if(1&i){const t=e.RV6();e.j41(0,"div",45)(1,"div",46),e.bIt("click",function(){const n=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.toggleGroup(n))}),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"span",47),e.EFF(5),e.k0s()(),e.DNE(6,w,10,3,"div",48),e.k0s()}if(2&i){const t=c.$implicit,o=e.XpG(3);e.R7$(3),e.JRh(o.classTitle(t)),e.R7$(2),e.JRh(o.collapsedGroups[t]?"\u2795":"\u2796"),e.R7$(),e.Y8G("ngIf",!o.collapsedGroups[t])}}function B(i,c){if(1&i&&(e.j41(0,"div"),e.DNE(1,A,7,3,"div",44),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.groupedKeys())}}function $(i,c){if(1&i&&e.DNE(0,B,2,1,"div",29),2&i){const t=e.XpG(),o=e.sdS(62);e.Y8G("ngIf",t.groupByClass)("ngIfElse",o)}}function D(i,c){if(1&i&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s()()),2&i){const t=c.$implicit;e.R7$(2),e.JRh(t.code),e.R7$(2),e.JRh(t.intitule),e.R7$(2),e.JRh(t.classe)}}function N(i,c){if(1&i){const t=e.RV6();e.j41(0,"table",49)(1,"thead")(2,"tr")(3,"th",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.sortBy("code"))}),e.EFF(4),e.k0s(),e.j41(5,"th",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.sortBy("intitule"))}),e.EFF(6),e.k0s(),e.j41(7,"th",50),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.sortBy("classe"))}),e.EFF(8),e.k0s()()(),e.j41(9,"tbody"),e.DNE(10,D,7,3,"tr",35),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(4),e.SpI("Code ","code"===t.sortKey?"asc"===t.sortDir?"\u25b2":"\u25bc":"",""),e.R7$(2),e.SpI("Intitul\xe9 ","intitule"===t.sortKey?"asc"===t.sortDir?"\u25b2":"\u25bc":"",""),e.R7$(2),e.SpI("Classe ","classe"===t.sortKey?"asc"===t.sortDir?"\u25b2":"\u25bc":"",""),e.R7$(2),e.Y8G("ngForOf",t.visibleItems)}}function P(i,c){if(1&i&&(e.j41(0,"li"),e.EFF(1),e.k0s()),2&i){const t=c.$implicit;e.R7$(),e.JRh(t)}}function G(i,c){if(1&i&&(e.j41(0,"div",51)(1,"h4"),e.EFF(2,"Erreurs d'import"),e.k0s(),e.j41(3,"ul"),e.DNE(4,P,2,1,"li",35),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.Y8G("ngForOf",t.importErrors)}}let S=(()=>{class i{constructor(t){this.coa=t,this.plan$=this.coa.getPlan(),this.allItems=[],this.visibleItems=[],this.classOptions=[],this.query="",this.selectedClass="",this.sortKey="code",this.sortDir="asc",this.groupByClass=!0,this.grouped={},this.collapsedGroups={},this.exportFilteredOnly=!0,this.showAddedOnly=!1,this.backendAvailable=!1,this.importPreview=[],this.importErrors=[],this.parentCode="",this.newCode="",this.newLabel="",this.addError="",this.addSuccess="",this.showTree=!1,this.nodes={},this.roots=[],this.lockedCodes=new Set}ngOnInit(){this.plan$.subscribe(t=>{this.allItems=t.map(o=>({...o,classe:this.normalizeClass(this.classFromCode(o.code))})),this.lockedCodes=new Set(this.allItems.map(o=>o.code)),this.classOptions=Array.from(new Set(this.allItems.map(o=>o.classe))).sort(),this.applyFilters(),this.rebuildTree()}),this.coa.loadFromBackend().subscribe({next:()=>this.backendAvailable=!0,error:()=>this.backendAvailable=!1})}normalizeClass(t){if(!t)return"Classe ?";const o=(t+"").match(/(\d)/);return o?`Classe ${o[1]}`:t}classFromCode(t){return"Classe "+(t?.charAt(0)||"?")}applyFilters(){const t=this.query.trim().toLowerCase();let o=this.allItems.filter(n=>(!t||n.code.toLowerCase().includes(t)||n.intitule.toLowerCase().includes(t))&&(!this.selectedClass||n.classe===this.selectedClass)&&(!this.showAddedOnly||!this.lockedCodes.has(n.code)));o=this.sortItems(o),this.visibleItems=o,this.groupByClass?(this.grouped=o.reduce((n,s)=>{const l=s.classe;return(n[l]=n[l]||[]).push(s),n},{}),Object.keys(this.grouped).forEach(n=>this.grouped[n]=this.sortItems(this.grouped[n]))):this.grouped={}}sortItems(t){const o="asc"===this.sortDir?1:-1;if("code"===this.sortKey)return[...t].sort((s,l)=>this.compareCode(s.code,l.code)*o);const n=this.sortKey;return[...t].sort((s,l)=>(""+(s[n]??"")).localeCompare(""+(l[n]??""),"fr",{numeric:!0})*o)}compareCode(t,o){const n=t.charAt(0),s=o.charAt(0);return n!==s?n.localeCompare(s,"fr",{numeric:!0}):t.length!==o.length?t.length-o.length:t.localeCompare(o,"fr",{numeric:!0})}sortBy(t){this.sortKey===t?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortKey=t,this.sortDir="asc"),this.applyFilters()}groupedKeys(){return Object.keys(this.grouped).sort((t,o)=>t.localeCompare(o,"fr",{numeric:!0}))}toggleGroup(t){this.collapsedGroups[t]=!this.collapsedGroups[t]}rowsToExport(){return this.exportFilteredOnly?this.groupByClass?Object.values(this.grouped).flat():this.visibleItems:this.sortItems(this.allItems)}exportCsv(){const t=this.rowsToExport(),n=[["code","intitule","classe"].join(";"),...t.map(l=>[l.code,this.escapeCsv(l.intitule),l.classe].join(";"))],s=new Blob(["\ufeff"+n.join("\n")],{type:"text/csv;charset=utf-8;"});this.downloadBlob(s,"plan-comptable.csv")}exportExcel(){const o=`\n      <html><head><meta charset="UTF-8"></head><body>\n      <table border="1"><thead><tr><th>Code</th><th>Intitul\xe9</th><th>Classe</th></tr></thead><tbody>\n      ${this.rowsToExport().map(s=>`<tr><td>${this.escapeHtml(s.code)}</td><td>${this.escapeHtml(s.intitule)}</td><td>${this.escapeHtml(s.classe||"")}</td></tr>`).join("")}\n      </tbody></table></body></html>`,n=new Blob([o],{type:"application/vnd.ms-excel"});this.downloadBlob(n,"plan-comptable.xls")}exportPdf(){const t=this.rowsToExport(),o=window.open("","_blank");o&&(o.document.write('<!doctype html><html><head><meta charset="UTF-8"><title>Plan comptable</title>\n      <style>body{font-family:Arial,sans-serif} table{width:100%;border-collapse:collapse} th,td{border:1px solid #ddd;padding:6px} th{background:#f7fafc}</style>\n    </head><body>'),o.document.write("<h2>Plan comptable</h2>"),o.document.write("<table><thead><tr><th>Code</th><th>Intitul\xe9</th><th>Classe</th></tr></thead><tbody>"),t.forEach(n=>o.document.write(`<tr><td>${this.escapeHtml(n.code)}</td><td>${this.escapeHtml(n.intitule)}</td><td>${this.escapeHtml(n.classe||"")}</td></tr>`)),o.document.write("</tbody></table></body></html>"),o.document.close(),o.focus(),o.print())}downloadBlob(t,o){const n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=o,s.click(),URL.revokeObjectURL(n)}escapeCsv(t){return t.includes(";")||t.includes('"')?'"'+t.replace(/"/g,'""')+'"':t}escapeHtml(t){return(t||"").replace(/[&<>"]/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[o]))}onImportFile(t){this.importPreview=[],this.importErrors=[];const n=t.target.files?.[0];if(!n)return;const s=new FileReader;s.onload=()=>{try{const l=s.result;let r=[];if(n.name.endsWith(".json")){const m=JSON.parse(l);r=this.mapImported(m)}else r=this.parseCsv(l);const{valid:p,errors:a,normalized:h}=this.validateImported(r);this.importErrors=a,this.importPreview=p?h:[]}catch(l){this.importErrors=["Fichier invalide: "+(l?.message||l)]}},s.readAsText(n,"utf-8")}mapImported(t){return Array.isArray(t)?t.map(o=>({code:String(o.code??o.numero??""),intitule:String(o.intitule??""),classe:this.normalizeClass(String(o.classe??""))})):[]}parseCsv(t){const o=t.split(/\r?\n/).filter(a=>a.trim().length);if(!o.length)return[];const n=o[0].split(/;|,|\t/).map(a=>a.trim().toLowerCase()),s=n.findIndex(a=>["code","numero"].includes(a)),l=n.findIndex(a=>["intitule","intitul\xe9","label","libelle","libell\xe9"].includes(a)),r=n.findIndex(a=>["classe","class"].includes(a)),p=[];for(let a=1;a<o.length;a++){const h=o[a].split(/;|,|\t/),m=(h[s]||"").trim(),C=(h[l]||"").trim(),X=this.normalizeClass((h[r]||"").trim());m&&C&&p.push({code:m,intitule:C,classe:X})}return p}validateImported(t){const o=[],n=new Set(this.allItems.map(r=>r.code)),s=new Set,l=[];for(const r of t){if(!/^\d+$/.test(r.code)){o.push(`Code non num\xe9rique: ${r.code}`);continue}const p=r.classe?.match(/Classe\s*(\d)/),a=p?p[1]:r.code.charAt(0);r.code.charAt(0)===a?n.has(r.code)?o.push(`Code d\xe9j\xe0 existant: ${r.code}`):s.has(r.code)?o.push(`Doublon dans le fichier: ${r.code}`):(s.add(r.code),l.push({code:r.code,intitule:r.intitule,classe:this.normalizeClass(r.classe)})):o.push(`Classe incoh\xe9rente pour ${r.code} (${r.classe})`)}return{valid:0===o.length,errors:o,normalized:l}}applyImport(){if(!this.importPreview.length)return;const t=this.importPreview.map(o=>({...o}));this.allItems=this.sortItems([...this.allItems,...t]),this.importPreview=[],this.applyFilters(),this.rebuildTree()}addSubAccount(){this.addError="",this.addSuccess="";const t=this.parentCode.trim(),o=this.newCode.trim(),n=this.newLabel.trim();if(!/^\d+$/.test(t))return void(this.addError="Code parent invalide");if(!/^\d+$/.test(o))return void(this.addError="Nouveau code invalide");if(!o.startsWith(t))return void(this.addError="Le nouveau code doit commencer par le code parent");if(!n)return void(this.addError="Intitul\xe9 requis");if(this.allItems.some(r=>r.code===o))return void(this.addError="Ce code existe d\xe9j\xe0");const s=this.allItems.find(r=>r.code===t),l=s?s.classe:this.normalizeClass(this.classFromCode(o));this.allItems=this.sortItems([...this.allItems,{code:o,intitule:n,classe:l,locked:!1}]),this.parentCode=this.newCode=this.newLabel="",this.addSuccess="Sous-compte ajout\xe9",this.applyFilters(),this.rebuildTree()}rebuildTree(){this.nodes={},this.roots=[];for(const o of this.allItems)this.nodes[o.code]={code:o.code,intitule:o.intitule,classe:o.classe,children:[],expanded:!1,locked:this.lockedCodes.has(o.code),description:o.description||""};for(const o of Object.keys(this.nodes)){const n=this.findParentCode(o);n&&this.nodes[n]?this.nodes[n].children.push(this.nodes[o]):this.roots.push(this.nodes[o])}const t=o=>{o.sort((n,s)=>this.compareCode(n.code,s.code)),o.forEach(n=>t(n.children))};t(this.roots)}findParentCode(t){for(let o=t.length-1;o>=1;o--){const n=t.substring(0,o);if(this.nodes[n])return n}return null}canEdit(t){return!t.locked}toggleExpand(t){t.expanded=!t.expanded}saveNode(t){if(t.locked)return;const o=this.allItems.find(n=>n.code===t.code);o&&(o.intitule=t.intitule,o.description=t.description,this.applyFilters())}deleteNode(t){if(t.locked)return;const o=new Set,n=s=>{o.add(s.code),s.children.forEach(n)};n(t),this.allItems=this.allItems.filter(s=>!o.has(s.code)),this.applyFilters(),this.rebuildTree()}confirmDeleteNode(t){t.locked||confirm(`Supprimer ${t.code} (${t.intitule}) et ses sous-comptes ?`)&&this.deleteNode(t)}loadFromServer(){this.coa.loadFromBackend().subscribe(t=>{const o=t.map(n=>({...n,classe:this.normalizeClass(this.classFromCode(n.code))}));this.allItems=this.sortItems(o),this.lockedCodes=new Set(this.allItems.filter(n=>n.locked).map(n=>n.code)),this.applyFilters(),this.rebuildTree()})}saveToServer(){this.coa.saveToBackend(this.allItems).subscribe(t=>{})}onImportServer(t){const o=t.target,n=o.files?.[0];n&&this.coa.importToBackend(n).subscribe(s=>{s.accepted?.length&&(this.allItems=this.sortItems([...this.allItems,...s.accepted]),this.applyFilters(),this.rebuildTree()),this.importErrors=s.errors||[],o.value=""})}classTitle(t){const o=t.match(/Classe\s*(\d)/);return function V(i){return{1:"Classe 1 \u2014 Comptes de ressources durables",2:"Classe 2 \u2014 Comptes d'actif immobilis\xe9",3:"Classe 3 \u2014 Comptes de stocks",4:"Classe 4 \u2014 Comptes de tiers",5:"Classe 5 \u2014 Comptes de tr\xe9sorerie",6:"Classe 6 \u2014 Comptes de charges",7:"Classe 7 \u2014 Comptes de produits",8:"Classe 8 \u2014 Autres charges et produits (HAO)",9:"Classe 9 \u2014 Engagements obtenus et accord\xe9s"}[i]||`Classe ${i}`}(o?o[1]:"?")}static{this.\u0275fac=function(o){return new(o||i)(e.rXU(b.x))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-chart-of-accounts"]],standalone:!0,features:[e.aNF],decls:64,vars:21,consts:[["tableViews",""],["flatTable",""],["renderNodes",""],[1,"module-container"],[1,"header-row"],[1,"actions"],[1,"chk"],["type","checkbox",3,"ngModelChange","ngModel"],["type","text","placeholder","Rechercher (code, intitul\xe9)...",1,"search",3,"ngModelChange","ngModel"],[1,"select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"btn",3,"click"],["title","Charger depuis le serveur",1,"btn",3,"click"],["title","Sauvegarder vers le serveur",1,"btn",3,"click"],[1,"importer"],["target","_blank",1,"btn",3,"href"],["type","file","accept",".json,.csv,.xlsx",3,"change"],[1,"toolbar"],["type","file","accept",".json,.csv",3,"change"],[1,"btn",3,"click","disabled"],["class","err",4,"ngIf"],[1,"add-subaccount"],[1,"row"],["placeholder","Code parent (ex: 401)",1,"input",3,"ngModelChange","ngModel"],["placeholder","Nouveau code (ex: 4011)",1,"input",3,"ngModelChange","ngModel"],["placeholder","Intitul\xe9",1,"input",3,"ngModelChange","ngModel"],["class","ok",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","import-errors",4,"ngIf"],[3,"value"],[1,"err"],[1,"ok"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngFor","ngForOf"],["class","toggle-icon",3,"click",4,"ngIf"],[1,"code"],[1,"inline",3,"ngModelChange","ngModel","disabled"],[1,"btn","small",3,"click","disabled"],[1,"btn","small","danger",3,"click","disabled"],["class","children",4,"ngIf"],[1,"toggle-icon",3,"click"],[1,"children"],["class","group-block",4,"ngFor","ngForOf"],[1,"group-block"],[1,"group-title",3,"click"],[1,"toggle"],[4,"ngIf"],[1,"plan-table"],[3,"click"],[1,"import-errors"]],template:function(o,n){if(1&o){const s=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"h1"),e.EFF(3,"\u{1f9fe} Plan Comptable"),e.k0s(),e.j41(4,"div",5)(5,"label",6)(6,"input",7),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.showTree,r)||(n.showTree=r),e.Njj(r)}),e.k0s(),e.EFF(7," Affichage arborescent"),e.k0s(),e.j41(8,"input",8),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.query,r)||(n.query=r),e.Njj(r)}),e.bIt("ngModelChange",function(){return e.eBV(s),e.Njj(n.applyFilters())}),e.k0s(),e.j41(9,"select",9),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.selectedClass,r)||(n.selectedClass=r),e.Njj(r)}),e.bIt("change",function(){return e.eBV(s),e.Njj(n.applyFilters())}),e.j41(10,"option",10),e.EFF(11,"Toutes les classes"),e.k0s(),e.DNE(12,k,2,2,"option",11),e.k0s(),e.j41(13,"label",6)(14,"input",7),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.exportFilteredOnly,r)||(n.exportFilteredOnly=r),e.Njj(r)}),e.k0s(),e.EFF(15," N'exporter que le filtr\xe9"),e.k0s(),e.j41(16,"label",6)(17,"input",12),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.showAddedOnly,r)||(n.showAddedOnly=r),e.Njj(r)}),e.bIt("change",function(){return e.eBV(s),e.Njj(n.applyFilters())}),e.k0s(),e.EFF(18," Afficher uniquement ajout\xe9s"),e.k0s(),e.j41(19,"button",13),e.bIt("click",function(){return e.eBV(s),e.Njj(n.exportCsv())}),e.EFF(20,"\u2b07\ufe0f CSV"),e.k0s(),e.j41(21,"button",13),e.bIt("click",function(){return e.eBV(s),e.Njj(n.exportExcel())}),e.EFF(22,"\u2b07\ufe0f Excel"),e.k0s(),e.j41(23,"button",13),e.bIt("click",function(){return e.eBV(s),e.Njj(n.exportPdf())}),e.EFF(24,"\u2b07\ufe0f PDF"),e.k0s(),e.j41(25,"button",14),e.bIt("click",function(){return e.eBV(s),e.Njj(n.loadFromServer())}),e.EFF(26,"\u2601\ufe0f Charger"),e.k0s(),e.j41(27,"button",15),e.bIt("click",function(){return e.eBV(s),e.Njj(n.saveToServer())}),e.EFF(28,"\u2601\ufe0f Sauvegarder"),e.k0s(),e.j41(29,"div",16)(30,"a",17),e.EFF(31,"\u2601\ufe0f CSV"),e.k0s(),e.j41(32,"a",17),e.EFF(33,"\u2601\ufe0f Excel"),e.k0s(),e.j41(34,"a",17),e.EFF(35,"\u2601\ufe0f PDF"),e.k0s(),e.j41(36,"input",18),e.bIt("change",function(r){return e.eBV(s),e.Njj(n.onImportServer(r))}),e.k0s()()()(),e.j41(37,"div",19)(38,"div")(39,"label")(40,"input",7),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.groupByClass,r)||(n.groupByClass=r),e.Njj(r)}),e.k0s(),e.EFF(41," Regrouper par classe"),e.k0s()(),e.j41(42,"div",16)(43,"input",20),e.bIt("change",function(r){return e.eBV(s),e.Njj(n.onImportFile(r))}),e.k0s(),e.j41(44,"button",21),e.bIt("click",function(){return e.eBV(s),e.Njj(n.applyImport())}),e.EFF(45),e.k0s(),e.DNE(46,F,2,1,"span",22),e.k0s()(),e.j41(47,"div",23)(48,"h3"),e.EFF(49,"\u2795 Ajouter un sous-compte"),e.k0s(),e.j41(50,"div",24)(51,"input",25),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.parentCode,r)||(n.parentCode=r),e.Njj(r)}),e.k0s(),e.j41(52,"input",26),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.newCode,r)||(n.newCode=r),e.Njj(r)}),e.k0s(),e.j41(53,"input",27),e.mxI("ngModelChange",function(r){return e.eBV(s),e.DH7(n.newLabel,r)||(n.newLabel=r),e.Njj(r)}),e.k0s(),e.j41(54,"button",13),e.bIt("click",function(){return e.eBV(s),e.Njj(n.addSubAccount())}),e.EFF(55,"Ajouter"),e.k0s()(),e.DNE(56,j,2,1,"div",22)(57,O,2,1,"div",28),e.k0s(),e.DNE(58,T,6,4,"div",29)(59,$,1,2,"ng-template",null,0,e.C5r)(61,N,11,4,"ng-template",null,1,e.C5r)(63,G,5,1,"div",30),e.k0s()}if(2&o){const s=e.sdS(60);e.R7$(6),e.R50("ngModel",n.showTree),e.R7$(2),e.R50("ngModel",n.query),e.R7$(),e.R50("ngModel",n.selectedClass),e.R7$(3),e.Y8G("ngForOf",n.classOptions),e.R7$(2),e.R50("ngModel",n.exportFilteredOnly),e.R7$(3),e.R50("ngModel",n.showAddedOnly),e.R7$(13),e.Y8G("href",n.coa.exportCsvFromBackend(n.exportFilteredOnly,n.query,n.selectedClass),e.B4B),e.R7$(2),e.Y8G("href",n.coa.exportXlsxFromBackend(n.exportFilteredOnly,n.query,n.selectedClass),e.B4B),e.R7$(2),e.Y8G("href",n.coa.exportPdfFromBackend(n.exportFilteredOnly,n.query,n.selectedClass),e.B4B),e.R7$(6),e.R50("ngModel",n.groupByClass),e.R7$(4),e.Y8G("disabled",!n.importPreview.length),e.R7$(),e.SpI("Importer ",n.importPreview.length," comptes"),e.R7$(),e.Y8G("ngIf",n.importErrors.length),e.R7$(5),e.R50("ngModel",n.parentCode),e.R7$(),e.R50("ngModel",n.newCode),e.R7$(),e.R50("ngModel",n.newLabel),e.R7$(3),e.Y8G("ngIf",n.addError),e.R7$(),e.Y8G("ngIf",n.addSuccess),e.R7$(),e.Y8G("ngIf",n.showTree)("ngIfElse",s),e.R7$(5),e.Y8G("ngIf",n.importErrors.length)}},dependencies:[_.MD,_.Sq,_.bT,_.T3,d.YN,d.xH,d.y7,d.me,d.Zm,d.wz,d.BC,d.vS],styles:[".module-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 16px #00000014}.header-row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}.chk[_ngcontent-%COMP%]{color:#4a5568;font-size:.9rem}.search[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;min-width:260px}.select[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px}.btn[_ngcontent-%COMP%]{padding:8px 10px;border:none;border-radius:6px;background:#3182ce;color:#fff;cursor:pointer}.btn[_ngcontent-%COMP%]:hover{background:#2b6cb0}.toolbar[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin:8px 0;flex-wrap:wrap;gap:.5rem}.importer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.plan-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:12px}.plan-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .plan-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e2e8f0;padding:8px 10px;text-align:left}.plan-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f7fafc;cursor:pointer;-webkit-user-select:none;user-select:none}.group-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background:#f7fafc;padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px;margin-top:12px;cursor:pointer}.group-title[_ngcontent-%COMP%]   .count[_ngcontent-%COMP%]{color:#4a5568;font-size:.9rem}.group-block[_ngcontent-%COMP%]{margin-bottom:8px}.import-errors[_ngcontent-%COMP%]{margin-top:12px;color:#e53e3e}.add-subaccount[_ngcontent-%COMP%]{margin-top:16px;padding:12px;border:1px dashed #e2e8f0;border-radius:8px}.add-subaccount[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}.add-subaccount[_ngcontent-%COMP%]   .input[_ngcontent-%COMP%]{padding:8px 12px;border:1px solid #e2e8f0;border-radius:6px}.err[_ngcontent-%COMP%]{color:#e53e3e;font-size:.9rem}.ok[_ngcontent-%COMP%]{color:#38a169;font-size:.9rem}.toggle-icon[_ngcontent-%COMP%]{cursor:pointer;margin-right:6px}.inline[_ngcontent-%COMP%]{padding:4px 6px;border:1px solid #e2e8f0;border-radius:4px;margin:0 6px;max-width:380px}.btn.small[_ngcontent-%COMP%]{padding:4px 6px;font-size:.85rem}.btn.small.danger[_ngcontent-%COMP%]{background:#e53e3e}.children[_ngcontent-%COMP%]{margin-left:1rem}"]})}}return i})()}}]);