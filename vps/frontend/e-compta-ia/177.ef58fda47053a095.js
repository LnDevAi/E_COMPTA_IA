"use strict";(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[177],{2177:(C,p,l)=>{l.r(p),l.d(p,{TiersComponent:()=>h});var c=l(177),s=l(4341),e=l(4438),_=l(1151);function g(r,a){if(1&r&&(e.j41(0,"div",18),e.EFF(1),e.k0s()),2&r){const n=e.XpG(2);e.R7$(),e.JRh(n.err)}}function u(r,a){if(1&r){const n=e.RV6();e.j41(0,"div",8)(1,"h3"),e.EFF(2),e.k0s(),e.j41(3,"div",9)(4,"label"),e.EFF(5,"Code"),e.j41(6,"input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.code,t)||(i.editing.code=t),e.Njj(t)}),e.k0s()(),e.j41(7,"label"),e.EFF(8,"Nom"),e.j41(9,"input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.name,t)||(i.editing.name=t),e.Njj(t)}),e.k0s()(),e.j41(10,"label"),e.EFF(11,"Type "),e.j41(12,"select",11),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.type,t)||(i.editing.type=t),e.Njj(t)}),e.bIt("change",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.prefillCode())}),e.j41(13,"option",12),e.EFF(14,"Client"),e.k0s(),e.j41(15,"option",13),e.EFF(16,"Fournisseur"),e.k0s(),e.j41(17,"option",14),e.EFF(18,"Autre"),e.k0s()()(),e.j41(19,"label"),e.EFF(20,"Email"),e.j41(21,"input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.email,t)||(i.editing.email=t),e.Njj(t)}),e.k0s()(),e.j41(22,"label"),e.EFF(23,"T\xe9l\xe9phone"),e.j41(24,"input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.phone,t)||(i.editing.phone=t),e.Njj(t)}),e.k0s()(),e.j41(25,"label"),e.EFF(26,"Adresse"),e.j41(27,"input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.address,t)||(i.editing.address=t),e.Njj(t)}),e.k0s()(),e.j41(28,"label"),e.EFF(29,"Compte par d\xe9faut"),e.j41(30,"input",15),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.editing.defaultAccount,t)||(i.editing.defaultAccount=t),e.Njj(t)}),e.k0s()()(),e.j41(31,"div",16)(32,"button",3),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.save())}),e.EFF(33,"Enregistrer"),e.k0s(),e.j41(34,"button",3),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.cancel())}),e.EFF(35,"Annuler"),e.k0s()(),e.DNE(36,g,2,1,"div",17),e.k0s()}if(2&r){const n=e.XpG();e.R7$(2),e.SpI("",n.editing.id?"Modifier":"Cr\xe9er"," un tiers"),e.R7$(4),e.R50("ngModel",n.editing.code),e.R7$(3),e.R50("ngModel",n.editing.name),e.R7$(3),e.R50("ngModel",n.editing.type),e.R7$(9),e.R50("ngModel",n.editing.email),e.R7$(3),e.R50("ngModel",n.editing.phone),e.R7$(3),e.R50("ngModel",n.editing.address),e.R7$(3),e.R50("ngModel",n.editing.defaultAccount),e.R7$(6),e.Y8G("ngIf",n.err)}}function m(r,a){if(1&r){const n=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td")(14,"button",3),e.bIt("click",function(){const t=e.eBV(n).$implicit,i=e.XpG();return e.Njj(i.startEdit(t))}),e.EFF(15,"Modifier"),e.k0s(),e.j41(16,"button",19),e.bIt("click",function(){const t=e.eBV(n).$implicit,i=e.XpG();return e.Njj(i.del(t.id))}),e.EFF(17,"Supprimer"),e.k0s()()()}if(2&r){const n=a.$implicit;e.R7$(2),e.JRh(n.code),e.R7$(2),e.JRh(n.name),e.R7$(2),e.JRh(n.type),e.R7$(2),e.JRh(n.defaultAccount),e.R7$(2),e.JRh(n.email),e.R7$(2),e.JRh(n.phone)}}let h=(()=>{class r{constructor(n){this.svc=n,this.q="",this.list=[],this.editing=null,this.err="",this.svc.getAll().subscribe(o=>this.list=o)}prefillCode(){!this.editing?.id&&!this.editing?.code&&(this.editing.code=this.svc.getNextCode(this.editing.type))}get filtered(){const n=this.q.trim().toLowerCase();return n?this.list.filter(o=>o.code.toLowerCase().includes(n)||o.name.toLowerCase().includes(n)||(o.email||"").toLowerCase().includes(n)):this.list}startAdd(){this.err="",this.editing={code:"",name:"",type:"AUTRE",email:"",phone:"",address:"",defaultAccount:""},this.prefillCode()}startEdit(n){this.err="",this.editing={...n}}save(){if(this.err="",this.editing)try{this.editing.id?this.svc.update(this.editing.id,this.editing):this.svc.create(this.editing),this.editing=null}catch(n){this.err=n?.message||"Erreur"}}cancel(){this.editing=null}del(n){confirm("Supprimer ?")&&this.svc.remove(n)}exportCsv(){const n=this.svc.exportCsv(),o=URL.createObjectURL(n),t=document.createElement("a");t.href=o,t.download="tiers.csv",t.click(),URL.revokeObjectURL(o)}onImport(n){const o=n.target,t=o.files?.[0];if(!t)return;const i=new FileReader;i.onload=()=>{this.svc.importCsv(String(i.result||"")),o.value=""},i.readAsText(t,"utf-8")}static{this.\u0275fac=function(o){return new(o||r)(e.rXU(_.t))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-tiers"]],standalone:!0,features:[e.aNF],decls:30,vars:3,consts:[[1,"module-container"],[1,"toolbar"],["placeholder","Rechercher...",1,"input",3,"ngModelChange","ngModel"],[1,"btn",3,"click"],["type","file","accept",".csv",3,"change"],["class","panel",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"panel"],[1,"grid"],[1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","change","ngModel"],["value","CLIENT"],["value","FOURNISSEUR"],["value","AUTRE"],["placeholder","ex: 411, 401",1,"input",3,"ngModelChange","ngModel"],[1,"row"],["class","err",4,"ngIf"],[1,"err"],[1,"btn","danger",3,"click"]],template:function(o,t){1&o&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2,"\u{1f465} Tiers"),e.k0s(),e.j41(3,"div",1)(4,"input",2),e.mxI("ngModelChange",function(d){return e.DH7(t.q,d)||(t.q=d),d}),e.k0s(),e.j41(5,"button",3),e.bIt("click",function(){return t.startAdd()}),e.EFF(6,"Nouveau"),e.k0s(),e.j41(7,"button",3),e.bIt("click",function(){return t.exportCsv()}),e.EFF(8,"Export CSV"),e.k0s(),e.j41(9,"input",4),e.bIt("change",function(d){return t.onImport(d)}),e.k0s()(),e.DNE(10,u,37,9,"div",5),e.j41(11,"table",6)(12,"thead")(13,"tr")(14,"th"),e.EFF(15,"Code"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Nom"),e.k0s(),e.j41(18,"th"),e.EFF(19,"Type"),e.k0s(),e.j41(20,"th"),e.EFF(21,"Compte d\xe9faut"),e.k0s(),e.j41(22,"th"),e.EFF(23,"Email"),e.k0s(),e.j41(24,"th"),e.EFF(25,"T\xe9l\xe9phone"),e.k0s(),e.j41(26,"th"),e.EFF(27,"Actions"),e.k0s()()(),e.j41(28,"tbody"),e.DNE(29,m,18,6,"tr",7),e.k0s()()()),2&o&&(e.R7$(4),e.R50("ngModel",t.q),e.R7$(6),e.Y8G("ngIf",t.editing),e.R7$(19),e.Y8G("ngForOf",t.filtered))},dependencies:[c.MD,c.Sq,c.bT,s.YN,s.xH,s.y7,s.me,s.wz,s.BC,s.vS],styles:[".module-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 16px #00000014}.toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;margin-bottom:8px}.input[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px}.btn[_ngcontent-%COMP%]{padding:8px 10px;border:none;border-radius:6px;background:#3182ce;color:#fff;cursor:pointer}.btn.danger[_ngcontent-%COMP%]{background:#e53e3e}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e2e8f0;padding:8px 10px;text-align:left}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(200px,1fr));gap:8px}.panel[_ngcontent-%COMP%]{border:1px solid #e2e8f0;border-radius:8px;padding:12px;margin-bottom:12px}"]})}}return r})()}}]);