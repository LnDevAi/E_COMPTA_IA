"use strict";(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[9],{1009:(Y,g,_)=>{_.r(g),_.d(g,{BalanceComponent:()=>U});var b=_(177),u=_(4341),t=_(4438),F=_(1941),v=_(2374);function E(n,s){1&n&&(t.j41(0,"th"),t.EFF(1,"SA D\xe9bit"),t.k0s())}function D(n,s){1&n&&(t.j41(0,"th"),t.EFF(1,"SA Cr\xe9dit"),t.k0s())}function R(n,s){1&n&&(t.j41(0,"th"),t.EFF(1,"Mvts D\xe9bit"),t.k0s())}function j(n,s){1&n&&(t.j41(0,"th"),t.EFF(1,"Mvts Cr\xe9dit"),t.k0s())}function I(n,s){if(1&n&&(t.j41(0,"td"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,e.prevDebit,"1.2-2"))}}function k(n,s){if(1&n&&(t.j41(0,"td"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,e.prevCredit,"1.2-2"))}}function x(n,s){if(1&n&&(t.j41(0,"td"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,e.movDebit,"1.2-2"))}}function $(n,s){if(1&n&&(t.j41(0,"td"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,e.movCredit,"1.2-2"))}}function B(n,s){if(1&n&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.DNE(5,I,3,4,"td",11)(6,k,3,4,"td",11)(7,x,3,4,"td",11)(8,$,3,4,"td",11),t.j41(9,"td"),t.EFF(10),t.nI1(11,"number"),t.k0s(),t.j41(12,"td"),t.EFF(13),t.nI1(14,"number"),t.k0s()()),2&n){const e=s.$implicit,r=t.XpG(2);t.R7$(2),t.JRh(e.compte),t.R7$(2),t.JRh(e.intitule),t.R7$(),t.Y8G("ngIf","6"===r.format),t.R7$(),t.Y8G("ngIf","6"===r.format),t.R7$(),t.Y8G("ngIf","2"!==r.format),t.R7$(),t.Y8G("ngIf","2"!==r.format),t.R7$(2),t.JRh(t.i5U(11,8,e.endDebit,"1.2-2")),t.R7$(3),t.JRh(t.i5U(14,11,e.endCredit,"1.2-2"))}}function M(n,s){if(1&n&&(t.j41(0,"th"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.i5U(2,1,e.total.prevDebit,"1.2-2"))}}function O(n,s){if(1&n&&(t.j41(0,"th"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.i5U(2,1,e.total.prevCredit,"1.2-2"))}}function T(n,s){if(1&n&&(t.j41(0,"th"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.i5U(2,1,e.total.movDebit,"1.2-2"))}}function S(n,s){if(1&n&&(t.j41(0,"th"),t.EFF(1),t.nI1(2,"number"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.i5U(2,1,e.total.movCredit,"1.2-2"))}}function G(n,s){if(1&n&&(t.j41(0,"table",10)(1,"thead")(2,"tr")(3,"th"),t.EFF(4,"Compte"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Intitul\xe9"),t.k0s(),t.DNE(7,E,2,0,"th",11)(8,D,2,0,"th",11)(9,R,2,0,"th",11)(10,j,2,0,"th",11),t.j41(11,"th"),t.EFF(12,"Solde D\xe9bit"),t.k0s(),t.j41(13,"th"),t.EFF(14,"Solde Cr\xe9dit"),t.k0s()()(),t.j41(15,"tbody"),t.DNE(16,B,15,14,"tr",12),t.k0s(),t.j41(17,"tfoot")(18,"tr")(19,"th",13),t.EFF(20,"Totaux"),t.k0s(),t.DNE(21,M,3,4,"th",11)(22,O,3,4,"th",11)(23,T,3,4,"th",11)(24,S,3,4,"th",11),t.j41(25,"th"),t.EFF(26),t.nI1(27,"number"),t.k0s(),t.j41(28,"th"),t.EFF(29),t.nI1(30,"number"),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(7),t.Y8G("ngIf","6"===e.format),t.R7$(),t.Y8G("ngIf","6"===e.format),t.R7$(),t.Y8G("ngIf","2"!==e.format),t.R7$(),t.Y8G("ngIf","2"!==e.format),t.R7$(6),t.Y8G("ngForOf",e.rows),t.R7$(5),t.Y8G("ngIf","6"===e.format),t.R7$(),t.Y8G("ngIf","6"===e.format),t.R7$(),t.Y8G("ngIf","2"!==e.format),t.R7$(),t.Y8G("ngIf","2"!==e.format),t.R7$(2),t.JRh(t.i5U(27,11,e.total.endDebit,"1.2-2")),t.R7$(3),t.JRh(t.i5U(30,14,e.total.endCredit,"1.2-2"))}}let U=(()=>{class n{constructor(e,r){this.js=e,this.coa=r,this.from=new Date((new Date).getFullYear(),0,1).toISOString().slice(0,10),this.to=(new Date).toISOString().slice(0,10),this.format="6",this.rows=[],this.total={prevDebit:0,prevCredit:0,movDebit:0,movCredit:0,endDebit:0,endCredit:0},this.libelles=new Map,this.coa.getPlan().subscribe(i=>{for(const o of i)this.libelles.set(o.code,o.intitule)})}labelFor(e){return this.libelles.get(e)||e}compute(){const e=this.js.ecritures$?.value||[],r=new Map,i=this.from,o=this.to,l=a=>a<i,f=a=>a>=i&&a<=o;for(const a of e)for(const d of a.lignes){const c=d.compte||"";if(!c)continue;r.has(c)||r.set(c,{compte:c,intitule:this.labelFor(c),prevDebit:0,prevCredit:0,movDebit:0,movCredit:0,endDebit:0,endCredit:0});const p=r.get(c);l(a.date)&&(p.prevDebit+=Number(d.debit)||0,p.prevCredit+=Number(d.credit)||0),f(a.date)&&(p.movDebit+=Number(d.debit)||0,p.movCredit+=Number(d.credit)||0)}this.rows=Array.from(r.values()).map(a=>{const p=a.prevDebit-a.prevCredit+(a.movDebit-a.movCredit),h=p>0?p:0,C=p<0?-p:0;return{...a,endDebit:h,endCredit:C}}).sort((a,d)=>a.compte.localeCompare(d.compte));const m={prevDebit:0,prevCredit:0,movDebit:0,movCredit:0,endDebit:0,endCredit:0};for(const a of this.rows)m.prevDebit+=a.prevDebit,m.prevCredit+=a.prevCredit,m.movDebit+=a.movDebit,m.movCredit+=a.movCredit,m.endDebit+=a.endDebit,m.endCredit+=a.endCredit;this.total=m}exportCsv(){const e=["compte","intitule"];"6"===this.format&&e.push("sa_debit","sa_credit"),"2"!==this.format&&e.push("mvt_debit","mvt_credit"),e.push("solde_debit","solde_credit");const r=e.join(";"),i=this.rows.map(o=>[o.compte,this.csv(o.intitule),..."6"===this.format?[o.prevDebit,o.prevCredit]:[],..."2"!==this.format?[o.movDebit,o.movCredit]:[],o.endDebit,o.endCredit].join(";"));this.downloadBlob(new Blob(["\ufeff"+[r,...i].join("\n")],{type:"text/csv;charset=utf-8;"}),"balance.csv")}exportExcel(){const e=["Compte","Intitul\xe9"];"6"===this.format&&e.push("SA D\xe9bit","SA Cr\xe9dit"),"2"!==this.format&&e.push("Mvt D\xe9bit","Mvt Cr\xe9dit"),e.push("Solde D\xe9bit","Solde Cr\xe9dit");const r=this.rows.map(o=>`<tr><td>${o.compte}</td><td>${this.escapeHtml(o.intitule)}</td>${"6"===this.format?`<td>${o.prevDebit}</td><td>${o.prevCredit}</td>`:""}${"2"!==this.format?`<td>${o.movDebit}</td><td>${o.movCredit}</td>`:""}<td>${o.endDebit}</td><td>${o.endCredit}</td></tr>`).join(""),i=`<table><thead><tr>${e.map(o=>`<th>${o}</th>`).join("")}</tr></thead><tbody>${r}</tbody></table>`;this.downloadBlob(new Blob([i],{type:"application/vnd.ms-excel"}),"balance.xls")}onImportOpeningBalances(e){const r=e.target,i=r.files?.[0];if(!i)return;const o=new FileReader;o.onload=()=>{const f=String(o.result||"").split(/\r?\n/).filter(c=>c.trim()),a=this.from||(new Date).toISOString().slice(0,10),d=[];for(let c=1;c<f.length;c++){const[p,h,C]=f[c].split(";"),w=Number(h||0),P=Number(C||0);p&&d.push({compte:p,libelle:"Solde ant\xe9rieur",debit:w,credit:P})}d.length&&(this.js.addEcriture({date:a,journalCode:"OD",piece:"OPEN",reference:"Soldes ant\xe9rieurs",lignes:d}),this.compute()),r.value=""},o.readAsText(i,"utf-8")}csv(e){return e?.includes(";")||e?.includes('"')?'"'+e.replace(/"/g,'""')+'"':e}downloadBlob(e,r){const i=URL.createObjectURL(e),o=document.createElement("a");o.href=i,o.download=r,o.click(),URL.revokeObjectURL(i)}escapeHtml(e){return(e||"").replace(/[&<>]/g,r=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[r]))}static{this.\u0275fac=function(r){return new(r||n)(t.rXU(F.p),t.rXU(v.x))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-balance"]],standalone:!0,features:[t.aNF],decls:27,vars:4,consts:[[1,"module-container"],[1,"toolbar"],["type","date",1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","ngModel"],["value","6"],["value","4"],["value","2"],[1,"btn",3,"click"],["type","file","accept",".csv",3,"change"],["class","table",4,"ngIf"],[1,"table"],[4,"ngIf"],[4,"ngFor","ngForOf"],["colspan","2"]],template:function(r,i){1&r&&(t.j41(0,"div",0)(1,"h1"),t.EFF(2,"\u{1f9ee} Balance"),t.k0s(),t.j41(3,"div",1)(4,"label"),t.EFF(5,"Du "),t.j41(6,"input",2),t.mxI("ngModelChange",function(l){return t.DH7(i.from,l)||(i.from=l),l}),t.k0s()(),t.j41(7,"label"),t.EFF(8,"Au "),t.j41(9,"input",2),t.mxI("ngModelChange",function(l){return t.DH7(i.to,l)||(i.to=l),l}),t.k0s()(),t.j41(10,"label"),t.EFF(11,"Format "),t.j41(12,"select",3),t.mxI("ngModelChange",function(l){return t.DH7(i.format,l)||(i.format=l),l}),t.j41(13,"option",4),t.EFF(14,"6 colonnes (SA, Mouvements, Soldes)"),t.k0s(),t.j41(15,"option",5),t.EFF(16,"4 colonnes (Mouvements, Soldes)"),t.k0s(),t.j41(17,"option",6),t.EFF(18,"2 colonnes (Soldes)"),t.k0s()()(),t.j41(19,"button",7),t.bIt("click",function(){return i.compute()}),t.EFF(20,"Calculer"),t.k0s(),t.j41(21,"button",7),t.bIt("click",function(){return i.exportCsv()}),t.EFF(22,"Export CSV"),t.k0s(),t.j41(23,"button",7),t.bIt("click",function(){return i.exportExcel()}),t.EFF(24,"Export Excel"),t.k0s(),t.j41(25,"input",8),t.bIt("change",function(l){return i.onImportOpeningBalances(l)}),t.k0s()(),t.DNE(26,G,31,17,"table",9),t.k0s()),2&r&&(t.R7$(6),t.R50("ngModel",i.from),t.R7$(3),t.R50("ngModel",i.to),t.R7$(3),t.R50("ngModel",i.format),t.R7$(14),t.Y8G("ngIf",i.rows.length))},dependencies:[b.MD,b.Sq,b.bT,b.QX,u.YN,u.xH,u.y7,u.me,u.wz,u.BC,u.vS],styles:[".module-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 4px 16px #00000014}.toolbar[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center;margin-bottom:8px}.input[_ngcontent-%COMP%]{padding:8px 10px;border:1px solid #e2e8f0;border-radius:6px}.btn[_ngcontent-%COMP%]{padding:8px 10px;border:none;border-radius:6px;background:#3182ce;color:#fff;cursor:pointer}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e2e8f0;padding:8px 10px;text-align:left}"]})}}return n})()}}]);