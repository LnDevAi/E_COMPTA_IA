(self.webpackChunke_compta_ia=self.webpackChunke_compta_ia||[]).push([[76],{4913:(x,m,l)=>{"use strict";l.d(m,{T:()=>p});var c=l(4412),d=l(4438);let p=(()=>{class o{constructor(){this.keyId="ecompta_enterprise_identity_v1",this.keySettings="ecompta_enterprise_settings_v1",this.keyUsers="ecompta_enterprise_users_v1",this.keyDirectors="ecompta_enterprise_directors_v1",this.keyTaxes="ecompta_enterprise_taxes_v1",this.identity$=new c.t(this.loadIdentity()),this.settings$=new c.t(this.loadSettings()),this.users$=new c.t(this.loadUsers()),this.directors$=new c.t(this.loadDirectors()),this.taxes$=new c.t(this.loadTaxes())}getIdentity(){return this.identity$.asObservable()}getSettings(){return this.settings$.asObservable()}getUsers(){return this.users$.asObservable()}getDirectors(){return this.directors$.asObservable()}getTaxes(){return this.taxes$.asObservable()}updateIdentity(s){const e={...this.identity$.value,...s};this.identity$.next(e),this.persist(this.keyId,e)}updateSettings(s){const e=this.settings$.value,t={fiscal:{...e.fiscal||{},...s.fiscal||{}},social:{...e.social||{},...s.social||{}},app:{...e.app||{},...s.app||{}}};this.settings$.next(t),this.persist(this.keySettings,t)}addUser(s){const e=`U-${Date.now()}`,t=[...this.users$.value,{...s,id:e}];this.users$.next(t),this.persist(this.keyUsers,t)}updateUser(s,e){const t=this.users$.value.map(r=>r.id===s?{...r,...e}:r);this.users$.next(t),this.persist(this.keyUsers,t)}removeUser(s){const e=this.users$.value.filter(t=>t.id!==s);this.users$.next(e),this.persist(this.keyUsers,e)}addDirector(s){const e=`D-${Date.now()}`,t=[...this.directors$.value,{...s,id:e}];this.directors$.next(t),this.persist(this.keyDirectors,t)}updateDirector(s,e){const t=this.directors$.value.map(r=>r.id===s?{...r,...e}:r);this.directors$.next(t),this.persist(this.keyDirectors,t)}removeDirector(s){const e=this.directors$.value.filter(t=>t.id!==s);this.directors$.next(e),this.persist(this.keyDirectors,e)}addTax(s){const e=`T-${Date.now()}`,t=[...this.taxes$.value,{...s,id:e}];this.taxes$.next(t),this.persist(this.keyTaxes,t)}updateTax(s,e){const t=this.taxes$.value.map(r=>r.id===s?{...r,...e}:r);this.taxes$.next(t),this.persist(this.keyTaxes,t)}removeTax(s){const e=this.taxes$.value.filter(t=>t.id!==s);this.taxes$.next(e),this.persist(this.keyTaxes,e)}replaceAllTaxes(s){const e=s.map((t,r)=>({...t,id:`T-${Date.now()}-${r}`}));this.taxes$.next(e),this.persist(this.keyTaxes,e)}roleTemplate(s){switch(s){case"ADMIN":return{canView:!0,canEditEntries:!0,canManageUsers:!0,canSubmitDeclarations:!0,canConfigure:!0,canImportExport:!0};case"COMPTABLE":return{canView:!0,canEditEntries:!0,canManageUsers:!1,canSubmitDeclarations:!0,canConfigure:!1,canImportExport:!0};case"VALIDEUR":return{canView:!0,canEditEntries:!1,canManageUsers:!1,canSubmitDeclarations:!0,canConfigure:!1,canImportExport:!1};default:return{canView:!0,canEditEntries:!1,canManageUsers:!1,canSubmitDeclarations:!1,canConfigure:!1,canImportExport:!1}}}loadIdentity(){try{const s=localStorage.getItem(this.keyId),e=s?JSON.parse(s):{},t=e.banks||(e.bankName||e.bankAccount?[{bankName:e.bankName||"",account:e.bankAccount||""}]:[]);return{name:"",legalForm:"",registrationNumber:"",taxId:"",activity:"",country:"",city:"",address:"",email:"",phone:"",...e,banks:t}}catch{return{name:"",legalForm:"",registrationNumber:"",taxId:"",activity:"",country:"",city:"",address:"",email:"",phone:""}}}loadSettings(){try{const s=localStorage.getItem(this.keySettings);return s?JSON.parse(s):{fiscal:{},social:{},app:{country:"",defaultJournal:"OD",defaultCurrency:"XOF",locale:"fr-FR",accountingSystem:"SYSCOHADA",chartOfAccounts:"SYSCOHADA"}}}catch{return{fiscal:{},social:{},app:{country:"",defaultJournal:"OD",defaultCurrency:"XOF",locale:"fr-FR",accountingSystem:"SYSCOHADA",chartOfAccounts:"SYSCOHADA"}}}}loadUsers(){try{const s=localStorage.getItem(this.keyUsers);return s?JSON.parse(s):[]}catch{return[]}}loadDirectors(){try{const s=localStorage.getItem(this.keyDirectors);return s?JSON.parse(s):[]}catch{return[]}}loadTaxes(){try{const s=localStorage.getItem(this.keyTaxes);return s?JSON.parse(s):[]}catch{return[]}}persist(s,e){try{localStorage.setItem(s,JSON.stringify(e))}catch{}}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=d.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})()},1941:(x,m,l)=>{"use strict";l.d(m,{p:()=>o});var c=l(4412),d=l(5312),p=l(4438);let o=(()=>{class h{constructor(){this.api=d.c.apiUrl,this.defaultJournaux=[{code:"ACH",libelle:"Achats",type:"ACHATS"},{code:"VEN",libelle:"Ventes",type:"VENTES"},{code:"BNK",libelle:"Banque",type:"BANQUE"},{code:"OD",libelle:"Op\xe9rations diverses",type:"OD"},{code:"SAL",libelle:"Salaires",type:"SALAIRES"},{code:"CSH",libelle:"Caisses",type:"CAISSES"},{code:"MNE",libelle:"Monnaie \xe9lectronique",type:"MONNAIE_ELECTRONIQUE"}],this.journaux$=new c.t([...this.defaultJournaux]),this.ecritures$=new c.t([]),this.templates$=new c.t(this.loadTemplates())}getJournaux(){return this.journaux$.asObservable()}getEcritures(){return this.ecritures$.asObservable()}getTemplates(){return this.templates$.asObservable()}addJournal(e){if(this.journaux$.value.some(r=>r.code===e.code))throw new Error("Code journal d\xe9j\xe0 existant");this.journaux$.next([...this.journaux$.value,e])}updateJournal(e,t){this.journaux$.next(this.journaux$.value.map(r=>r.code===e?{...r,...t,code:r.code}:r))}removeJournal(e){this.journaux$.next(this.journaux$.value.filter(r=>r.code!==e)),this.ecritures$.next(this.ecritures$.value.filter(r=>r.journalCode!==e));const t=this.templates$.value.filter(r=>r.journalCode!==e);this.templates$.next(t),this.persistTemplates(t)}addEcriture(e){const t=e.lignes.reduce((n,u)=>n+(Number(u.debit)||0),0),r=e.lignes.reduce((n,u)=>n+(Number(u.credit)||0),0);if(0!==Math.round(100*(t-r)))throw new Error("\xc9criture non \xe9quilibr\xe9e");const i=`${e.journalCode}-${Date.now()}`,a={...e,id:i,totalDebit:t,totalCredit:r};this.ecritures$.next([...this.ecritures$.value,a])}addEcrituresBatch(e){const t=[...this.ecritures$.value];for(const r of e){const i=r.lignes.reduce((n,u)=>n+(Number(u.debit)||0),0),a=r.lignes.reduce((n,u)=>n+(Number(u.credit)||0),0);0===Math.round(100*(i-a))&&t.push({...r,totalDebit:i,totalCredit:a})}this.ecritures$.next(t)}deleteEcriture(e){this.ecritures$.next(this.ecritures$.value.filter(t=>t.id!==e))}getEcriture(e){return this.ecritures$.value.find(t=>t.id===e)}updateEcriture(e){const t=e.lignes.reduce((i,a)=>i+(Number(a.debit)||0),0),r=e.lignes.reduce((i,a)=>i+(Number(a.credit)||0),0);if(0!==Math.round(100*(t-r)))throw new Error("\xc9criture non \xe9quilibr\xe9e");e.totalDebit=t,e.totalCredit=r,this.ecritures$.next(this.ecritures$.value.map(i=>i.id===e.id?{...e}:i))}createTemplate(e,t,r){const a={id:`${e}-${Date.now()}`,journalCode:e,name:t,lignes:r.map(u=>({...u}))},n=[...this.templates$.value,a];return this.templates$.next(n),this.persistTemplates(n),a}updateTemplate(e,t,r){const i=this.templates$.value.map(a=>a.id===e?{...a,name:t,lignes:r.map(n=>({...n}))}:a);this.templates$.next(i),this.persistTemplates(i)}deleteTemplate(e){const t=this.templates$.value.filter(r=>r.id!==e);this.templates$.next(t),this.persistTemplates(t)}loadTemplates(){try{const e=localStorage.getItem("ecompta_templates_v1");if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}persistTemplates(e){try{localStorage.setItem("ecompta_templates_v1",JSON.stringify(e))}catch{}}exportJournauxCsv(){const t=this.journaux$.value.map(r=>[r.code,this.csv(r.libelle),r.type].join(";"));return new Blob(["\ufeff"+["code;libelle;type",...t].join("\n")],{type:"text/csv;charset=utf-8;"})}exportEcrituresCsv(e){const r=[];for(const i of this.ecritures$.value)if(!e||i.journalCode===e)for(const a of i.lignes)r.push([i.id,i.date,i.journalCode,i.piece||"",i.reference||"",a.compte,this.csv(a.libelle),a.debit,a.credit].join(";"));return new Blob(["\ufeff"+["id;date;journal;piece;reference;compte;libelle;debit;credit",...r].join("\n")],{type:"text/csv;charset=utf-8;"})}exportHtmlTableExcel(e){return new Blob([e],{type:"application/vnd.ms-excel"})}csv(e){return e?.includes(";")||e?.includes('"')?'"'+e.replace(/"/g,'""')+'"':e}static{this.\u0275fac=function(t){return new(t||h)}}static{this.\u0275prov=p.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},1151:(x,m,l)=>{"use strict";l.d(m,{t:()=>p});var c=l(4412),d=l(4438);let p=(()=>{class o{constructor(){this.key="ecompta_tiers_v1",this.tiers$=new c.t(this.load())}getAll(){return this.tiers$.asObservable()}getValue(){return this.tiers$.value}prefixFor(s){return"CLIENT"===s?"CLT":"FOURNISSEUR"===s?"FRS":"AUT"}nextNumberFor(s){const e=this.prefixFor(s)+"-",t=this.tiers$.value.filter(r=>r.type===s&&r.code.startsWith(e)).map(r=>parseInt(r.code.slice(e.length),10)).filter(r=>!isNaN(r));return t.length?Math.max(...t)+1:1}getNextCode(s){const e=this.nextNumberFor(s);return`${this.prefixFor(s)}-${String(e).padStart(4,"0")}`}isCodeTaken(s,e){return this.tiers$.value.some(t=>t.code.toUpperCase()===s.toUpperCase()&&t.id!==e)}create(s){const e={...s};let t=(e.code||"").trim();if(t||(t=this.getNextCode(e.type)),this.isCodeTaken(t))throw new Error("Code tiers d\xe9j\xe0 utilis\xe9");const r=`TIER-${Date.now()}`,i=[...this.tiers$.value,{...e,code:t,id:r}];this.tiers$.next(i),this.persist(i)}update(s,e){const t=this.tiers$.value.find(n=>n.id===s);if(!t)return;const r=(e.code??t.code).trim();if(!r)throw new Error("Code requis");if(this.isCodeTaken(r,s))throw new Error("Code tiers d\xe9j\xe0 utilis\xe9");const i={...t,...e,code:r},a=this.tiers$.value.map(n=>n.id===s?i:n);this.tiers$.next(a),this.persist(a)}remove(s){const e=this.tiers$.value.filter(t=>t.id!==s);this.tiers$.next(e),this.persist(e)}exportCsv(){const e=this.tiers$.value.map(t=>[t.id,t.code,this.csv(t.name),t.type,t.email||"",t.phone||"",this.csv(t.address||""),t.defaultAccount||""].join(";"));return new Blob(["\ufeff"+["id;code;name;type;email;phone;address;defaultAccount",...e].join("\n")],{type:"text/csv;charset=utf-8;"})}importCsv(s){const e=s.split(/\r?\n/).filter(r=>r.trim().length>0);if(e.length<=1)return;const t=[];for(let r=1;r<e.length;r++){const i=this.parseCsvLine(e[r]),[a,n,u,v,g,y,E,b]=i,$=String(v||"AUTRE").toUpperCase();let f=(n||"").trim();if(f||(f=this.getNextCode($)),t.some(S=>S.code.toUpperCase()===f.toUpperCase())||this.isCodeTaken(f))continue;const C=a||`TIER-${Date.now()}-${r}`;t.push({id:C,code:f,name:u?.replace(/^"|"$/g,""),type:$,email:g,phone:y,address:E?.replace(/^"|"$/g,""),defaultAccount:b})}this.tiers$.next(t),this.persist(t)}load(){try{const s=localStorage.getItem(this.key);return s?JSON.parse(s):[]}catch{return[]}}persist(s){try{localStorage.setItem(this.key,JSON.stringify(s))}catch{}}csv(s){return s?.includes(";")||s?.includes('"')?'"'+s.replace(/"/g,'""')+'"':s}parseCsvLine(s){const e=[];let t="",r=!1;for(let i=0;i<s.length;i++){const a=s[i];'"'===a?(r=!r,t+=a):";"!==a||r?t+=a:(e.push(t),t="")}return e.push(t),e}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=d.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})()},9293:x=>{function m(c,d,p,o,h,s,e){try{var t=c[s](e),r=t.value}catch(i){return void p(i)}t.done?d(r):Promise.resolve(r).then(o,h)}x.exports=function l(c){return function(){var d=this,p=arguments;return new Promise(function(o,h){var s=c.apply(d,p);function e(r){m(s,o,h,e,t,"next",r)}function t(r){m(s,o,h,e,t,"throw",r)}e(void 0)})}},x.exports.__esModule=!0,x.exports.default=x.exports}}]);